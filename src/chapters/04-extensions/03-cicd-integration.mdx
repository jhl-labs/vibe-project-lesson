import { Meta } from '@storybook/addon-docs/blocks';
import { Callout } from '../../components/Callout';
import { CodeBlock } from '../../components/CodeBlock';
import { ComparisonTable } from '../../components/ComparisonTable';
import { MermaidDiagram } from '../../components/MermaidDiagram';
import { DataTable } from '../../components/DataTable';
import { ChapterNav } from '../../components/ChapterNav';
import prCommentImg from '../../assets/images/claude-code-action-pr-comment.png';

<Meta title="Part 4: 확장과 자동화/CI/CD 통합" />

# GitHub Actions 통합

> Claude Code를 활용한 GitHub 자동화

## claude-code-action이란?

`anthropics/claude-code-action`은 Anthropic이 공식 제공하는 GitHub Action으로, Claude Code의 능력을 GitHub 워크플로우에 직접 통합합니다. PR 리뷰, 이슈 분류, 코드 생성 등 다양한 작업을 자동화하며, 2025년 5월 초기 출시 후 **2025년 8월에 v1.0이 정식 출시**되었습니다 ([GitHub Marketplace](https://github.com/marketplace/actions/claude-code-action)).

<Callout type="info" title="핵심 특징">
  claude-code-action은 저장소 루트의 **CLAUDE.md** 파일을 자동으로 인식하여 프로젝트별 코딩 가이드라인을 따릅니다.
  또한 **자동 모드 감지** 기능으로 `@claude` 멘션이나 이슈 할당 시 Interactive 모드, `prompt` 입력 시 Automation 모드로 자동 전환됩니다.
</Callout>

## 설치 및 초기 설정

### GitHub App 설치

가장 간편한 방법은 Claude Code CLI에서 직접 설치하는 것입니다:

<CodeBlock
  code={`# Claude Code CLI에서 실행
/install-github-app`}
  language="bash"
  filename="GitHub App 설치"
/>

수동으로 설치하려면 다음 단계를 따릅니다:

1. [github.com/apps/claude](https://github.com/apps/claude)에서 **Install** 클릭
2. 대상 저장소를 선택하고 권한을 승인
3. 저장소에 `.github/workflows/` 디렉토리 생성 후 워크플로우 파일 추가

### GitHub Secrets 설정

<CodeBlock
  code={`# GitHub Repository Settings > Secrets and variables > Actions

# 필수: Anthropic API 키
ANTHROPIC_API_KEY=sk-ant-api03-...

# 선택: GitHub 관련 기능 사용 시
# GITHUB_TOKEN은 자동 제공됨`}
  language="bash"
  filename="GitHub Secrets 설정"
/>

<Callout type="important" title="시크릿 관리">
  API 키는 절대 코드에 하드코딩하지 마세요. 반드시 GitHub Secrets를 통해 관리해야 합니다.
</Callout>

## 동작 모드: Interactive vs Automation

claude-code-action은 **두 가지 모드**로 동작하며, 워크플로우 설정에 따라 자동으로 감지됩니다.

<MermaidDiagram
  chart={`flowchart TD
    START["워크플로우 트리거"] --> CHECK{"prompt 파라미터가\n설정되어 있는가?"}
    CHECK -->|"예"| AUTO["Automation 모드"]
    CHECK -->|"아니오"| INTER["Interactive 모드"]
    AUTO --> AUTO_DESC["• 정의된 prompt를 자동 실행\n• 사람 개입 없이 완료\n• PR 생성, 이슈 처리 등"]
    INTER --> INTER_DESC["• @claude 멘션으로 대화\n• 이슈 할당으로 작업 요청\n• 실시간 상호작용"]
    style START fill:#f0ece5,stroke:#8c857c,color:#2d2a26
    style CHECK fill:#fdf2ee,stroke:#da7756,color:#2d2a26
    style AUTO fill:#e8f5e9,stroke:#16a34a,color:#2d2a26
    style INTER fill:#e3f2fd,stroke:#3b82f6,color:#2d2a26
    style AUTO_DESC fill:#f0ece5,stroke:#8c857c,color:#2d2a26
    style INTER_DESC fill:#f0ece5,stroke:#8c857c,color:#2d2a26`}
  title="동작 모드 결정 흐름도"
  caption="prompt 파라미터 유무에 따라 모드가 자동으로 결정됩니다"
/>

### Interactive 모드

사용자가 직접 Claude와 대화하며 작업을 요청하는 모드입니다. PR 코멘트에서 `@claude`를 멘션하거나, 이슈를 Claude에게 할당하면 활성화됩니다.

<CodeBlock
  code={`# .github/workflows/claude-interactive.yml
name: Claude Interactive

on:
  issue_comment:
    types: [created]
  pull_request_review_comment:
    types: [created]
  issues:
    types: [opened, assigned]

permissions:
  contents: write
  pull-requests: write
  issues: write
  id-token: write

jobs:
  claude:
    if: |
      (github.event_name == 'issue_comment' && contains(github.event.comment.body, '@claude')) ||
      (github.event_name == 'pull_request_review_comment' && contains(github.event.comment.body, '@claude')) ||
      (github.event_name == 'issues' && contains(github.event.issue.assignees.*.login, 'claude'))
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: \${{ secrets.ANTHROPIC_API_KEY }}
          # prompt 없음 → Interactive 모드 자동 감지`}
  language="yaml"
  filename="claude-interactive.yml"
/>

### Automation 모드

`prompt` 파라미터를 설정하면 자동으로 Automation 모드로 동작합니다. 사람 개입 없이 정의된 작업을 자동으로 수행합니다.

<CodeBlock
  code={`# .github/workflows/claude-automation.yml
name: Claude Automation

on:
  pull_request:
    types: [opened, synchronize]

permissions:
  contents: write
  pull-requests: write
  issues: write
  id-token: write

jobs:
  review:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: \${{ secrets.ANTHROPIC_API_KEY }}
          prompt: |
            이 PR의 변경사항을 리뷰해주세요.
            보안, 성능, 코드 품질을 중점적으로 확인하세요.
          # prompt 있음 → Automation 모드 자동 감지`}
  language="yaml"
  filename="claude-automation.yml"
/>

<ComparisonTable
  title="Interactive vs Automation 모드 비교"
  headers={['특성', 'Interactive 모드', 'Automation 모드']}
  rows={[
    { feature: 'prompt 파라미터', values: ['설정하지 않음', '필수 설정'] },
    { feature: '트리거 방식', values: ['@claude 멘션, 이슈 할당', 'PR/이슈 이벤트 자동'] },
    { feature: '사용자 개입', values: ['실시간 대화 가능', '개입 없이 자동 실행'] },
    { feature: '주요 용도', values: ['질문, 디버깅, 탐색', 'PR 리뷰, 이슈 분류, CI'] },
    { feature: '응답 위치', values: ['코멘트 스레드', 'PR/이슈 코멘트'] },
  ]}
/>

## 트리거 유형

claude-code-action은 다양한 GitHub 이벤트에 의해 트리거될 수 있습니다.

<DataTable
  title="지원되는 트리거 유형"
  searchable={true}
  pageSize={10}
  columns={[
    { key: 'trigger', header: '트리거', width: '200px' },
    { key: 'event', header: '이벤트', width: '180px' },
    { key: 'mode', header: '모드', width: '120px' },
    { key: 'description', header: '설명' },
  ]}
  data={[
    { trigger: 'issue_comment', event: 'created', mode: 'Interactive', description: 'PR 또는 이슈 코멘트에서 @claude 멘션 시 트리거' },
    { trigger: 'pull_request_review_comment', event: 'created', mode: 'Interactive', description: 'PR 리뷰 코멘트에서 @claude 멘션 시 트리거' },
    { trigger: 'pull_request', event: 'opened, synchronize', mode: 'Automation', description: 'PR 생성 또는 업데이트 시 자동 트리거' },
    { trigger: 'issues', event: 'opened, assigned', mode: 'Both', description: '이슈 생성 또는 할당 시 트리거' },
    { trigger: 'pull_request_review', event: 'submitted', mode: 'Both', description: 'PR 리뷰 제출 시 트리거' },
    { trigger: 'repository_dispatch', event: 'custom', mode: 'Automation', description: 'API를 통한 외부 트리거' },
    { trigger: 'schedule', event: 'cron', mode: 'Automation', description: 'cron 스케줄에 따른 주기적 실행' },
  ]}
/>

## 인증 방식

claude-code-action은 4가지 인증 방식을 지원합니다. 사용 환경에 맞는 방식을 선택하세요.

<MermaidDiagram
  chart={`flowchart LR
    ACTION["claude-code-action"] --> A["Direct API Key"]
    ACTION --> B["AWS Bedrock"]
    ACTION --> C["Google Vertex AI"]
    ACTION --> D["Microsoft Foundry"]
    A --> A1["anthropic_api_key"]
    B --> B1["aws_access_key_id +\naws_secret_access_key +\naws_region"]
    C --> C1["google_project_id +\ngoogle_region +\nOIDC"]
    D --> D1["use_foundry +\nANTHROPIC_FOUNDRY_BASE_URL +\nOIDC/API Key"]
    style ACTION fill:#fdf2ee,stroke:#da7756,color:#2d2a26
    style A fill:#e8f5e9,stroke:#16a34a,color:#2d2a26
    style B fill:#fff3e0,stroke:#d97706,color:#2d2a26
    style C fill:#e3f2fd,stroke:#3b82f6,color:#2d2a26
    style D fill:#f3e5f5,stroke:#9c27b0,color:#2d2a26
    style A1 fill:#f0ece5,stroke:#8c857c,color:#2d2a26
    style B1 fill:#f0ece5,stroke:#8c857c,color:#2d2a26
    style C1 fill:#f0ece5,stroke:#8c857c,color:#2d2a26
    style D1 fill:#f0ece5,stroke:#8c857c,color:#2d2a26`}
  title="인증 방식 비교"
  caption="4가지 인증 경로 중 사용 환경에 맞는 방식을 선택하세요"
/>

**1. Direct API Key (가장 간단)**

<CodeBlock
  code={`- uses: anthropics/claude-code-action@v1
  with:
    anthropic_api_key: \${{ secrets.ANTHROPIC_API_KEY }}`}
  language="yaml"
  filename="Direct API Key"
/>

**2. AWS Bedrock**

<CodeBlock
  code={`- uses: anthropics/claude-code-action@v1
  with:
    use_bedrock: "true"
    aws_access_key_id: \${{ secrets.AWS_ACCESS_KEY_ID }}
    aws_secret_access_key: \${{ secrets.AWS_SECRET_ACCESS_KEY }}
    aws_region: "us-east-1"`}
  language="yaml"
  filename="AWS Bedrock"
/>

**3. Google Vertex AI**

<CodeBlock
  code={`- uses: anthropics/claude-code-action@v1
  with:
    use_vertex: "true"
    google_project_id: "my-project-id"
    google_region: "us-east5"
    # OIDC를 통한 자동 인증 (id-token: write 권한 필요)`}
  language="yaml"
  filename="Google Vertex AI"
/>

**4. Microsoft Foundry**

<CodeBlock
  code={`- name: Authenticate to Azure
  uses: azure/login@v2
  with:
    client-id: \${{ secrets.AZURE_CLIENT_ID }}
    tenant-id: \${{ secrets.AZURE_TENANT_ID }}
    subscription-id: \${{ secrets.AZURE_SUBSCRIPTION_ID }}

- uses: anthropics/claude-code-action@v1
  with:
    use_foundry: "true"
  env:
    ANTHROPIC_FOUNDRY_BASE_URL: https://my-resource.services.ai.azure.com`}
  language="yaml"
  filename="Microsoft Foundry"
/>

<Callout type="tip" title="OIDC 인증 권장">
  클라우드 환경(AWS, GCP, Azure)을 사용할 경우 OIDC 기반 인증을 권장합니다.
  장기 자격 증명 대신 단기 토큰을 사용하여 보안이 강화되며, `id-token: write` 권한만 추가하면 됩니다.
</Callout>

## 설정 옵션 레퍼런스

<DataTable
  title="claude-code-action 주요 설정 옵션"
  searchable={true}
  pageSize={12}
  columns={[
    { key: 'option', header: '옵션', width: '180px' },
    { key: 'required', header: '필수', width: '60px' },
    { key: 'defaultVal', header: '기본값', width: '120px' },
    { key: 'description', header: '설명' },
  ]}
  data={[
    { option: 'anthropic_api_key', required: '조건부', defaultVal: '-', description: 'Anthropic API 키 (Direct 방식 시 필수)' },
    { option: 'prompt', required: '아니오', defaultVal: '-', description: '자동 실행할 프롬프트 (설정 시 Automation 모드)' },
    { option: 'claude_args', required: '아니오', defaultVal: '-', description: 'Claude Code CLI 추가 인자 (--max-turns, --model 등)' },
    { option: 'trigger_phrase', required: '아니오', defaultVal: '@claude', description: 'Interactive 모드 트리거 문구' },
    { option: 'assignee_trigger', required: '아니오', defaultVal: '-', description: '이슈 할당 시 자동 트리거할 사용자명' },
    { option: 'label_trigger', required: '아니오', defaultVal: 'claude', description: '특정 라벨 추가 시 트리거' },
    { option: 'settings', required: '아니오', defaultVal: '-', description: 'Claude Code 설정 (JSON 문자열 또는 파일 경로)' },
    { option: 'mcp_config', required: '아니오', defaultVal: '-', description: 'MCP 서버 설정 (JSON 문자열)' },
    { option: 'use_bedrock', required: '아니오', defaultVal: 'false', description: 'AWS Bedrock 사용 여부' },
    { option: 'use_vertex', required: '아니오', defaultVal: 'false', description: 'Google Vertex AI 사용 여부' },
    { option: 'use_foundry', required: '아니오', defaultVal: 'false', description: 'Microsoft Foundry 사용 여부' },
    { option: 'use_sticky_comment', required: '아니오', defaultVal: 'false', description: '하나의 코멘트로 결과 전달' },
    { option: 'track_progress', required: '아니오', defaultVal: 'false', description: '진행 상황 추적 코멘트 활성화' },
  ]}
/>

### claude_args 주요 플래그

`claude_args`를 통해 Claude Code CLI의 다양한 옵션을 전달할 수 있습니다:

<CodeBlock
  code={`- uses: anthropics/claude-code-action@v1
  with:
    anthropic_api_key: \${{ secrets.ANTHROPIC_API_KEY }}
    prompt: "이 PR을 리뷰해주세요"
    claude_args: >-
      --max-turns 10
      --model claude-sonnet-4-20250514
      --allowedTools "Bash,Read,Write,Edit"
      --disallowedTools "WebFetch"
    # 참고: model, max-turns 등은 claude_args를 통해 CLI 옵션으로 전달합니다`}
  language="yaml"
  filename="claude_args 사용 예시"
/>

### MCP 서버 설정

claude-code-action 내에서 MCP 서버를 활용할 수 있습니다:

<CodeBlock
  code={`- uses: anthropics/claude-code-action@v1
  with:
    anthropic_api_key: \${{ secrets.ANTHROPIC_API_KEY }}
    prompt: "Linear 이슈와 연결된 PR을 리뷰해주세요"
    mcp_config: |
      {
        "mcpServers": {
          "linear": {
            "command": "npx",
            "args": ["-y", "mcp-remote", "https://mcp.linear.app/mcp"]
          }
        }
      }`}
  language="yaml"
  filename="MCP 서버 설정"
/>

## 출력값 (Outputs)

claude-code-action은 실행 후 다양한 출력값을 제공하며, 후속 스텝에서 활용할 수 있습니다.

| 출력값 | 설명 |
|--------|------|
| `execution_file` | 전체 실행 로그 파일 경로 |
| `branch_name` | Claude가 생성한 브랜치 이름 (있는 경우) |
| `session_id` | Claude Code 세션 ID |
| `structured_output` | 구조화된 JSON 출력 (claude_args에 --json-schema 사용 시) |

<CodeBlock
  code={`jobs:
  analyze:
    runs-on: ubuntu-latest
    outputs:
      result: \${{ steps.claude.outputs.structured_output }}
    steps:
      - uses: actions/checkout@v4
      - id: claude
        uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: \${{ secrets.ANTHROPIC_API_KEY }}
          prompt: "이 코드의 복잡도를 분석해주세요"
          claude_args: >-
            --json-schema '{"type":"object","properties":{"complexity":{"type":"string","enum":["low","medium","high"]},"issues":{"type":"array","items":{"type":"string"}}},"required":["complexity","issues"]}'

  notify:
    needs: analyze
    runs-on: ubuntu-latest
    steps:
      - name: Use Analysis Result
        run: |
          echo "분석 결과: \${{ needs.analyze.outputs.result }}"`}
  language="yaml"
  filename="출력값 활용 예시"
/>

## 실전 워크플로우 예제

### 1. PR Review — 자동 코드 리뷰

<CodeBlock
  code={`# .github/workflows/claude-pr-review.yml
name: Claude PR Review

on:
  pull_request:
    types: [opened, synchronize]

permissions:
  contents: write
  pull-requests: write
  issues: write
  id-token: write
  actions: read

jobs:
  review:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: \${{ secrets.ANTHROPIC_API_KEY }}
          prompt: |
            이 PR의 변경사항을 리뷰해주세요.
            보안, 성능, 코드 품질을 중점적으로 확인하고
            CLAUDE.md의 코딩 가이드라인 기준을 따라주세요.`}
  language="yaml"
  filename="claude-pr-review.yml"
/>

<Callout type="info" title="자동 리뷰의 장점">
  모든 PR에 일관된 품질의 1차 리뷰를 자동으로 수행합니다.
  보안 취약점이나 컨벤션 위반을 사전에 잡을 수 있습니다.
</Callout>

### 2. Issue Triage — 자동 이슈 분류

<CodeBlock
  code={`# .github/workflows/claude-issue-triage.yml
name: Claude Issue Triage

on:
  issues:
    types: [opened]

permissions:
  contents: write
  pull-requests: write
  issues: write
  id-token: write

jobs:
  triage:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: \${{ secrets.ANTHROPIC_API_KEY }}
          prompt: |
            이 이슈를 분석하고:
            1. 적절한 라벨을 추가해주세요 (bug, feature, docs 등)
            2. 우선순위를 판단해주세요 (P0~P3)
            3. 관련 코드 영역을 파악해주세요
            4. 가능하다면 해결 방향을 제시해주세요`}
  language="yaml"
  filename="claude-issue-triage.yml"
/>

### 3. Code Suggest — 코드 개선 제안

<CodeBlock
  code={`# .github/workflows/claude-code-suggest.yml
name: Claude Code Suggest

on:
  pull_request:
    types: [opened]

permissions:
  contents: write
  pull-requests: write
  issues: write
  id-token: write

jobs:
  suggest:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: \${{ secrets.ANTHROPIC_API_KEY }}
          prompt: |
            이 PR의 코드를 분석하고 개선 제안을 해주세요:
            - 성능 최적화 기회
            - 더 나은 패턴/관용구
            - 에러 처리 개선`}
  language="yaml"
  filename="claude-code-suggest.yml"
/>

### 4. Doc Sync — 코드-문서 동기화

<CodeBlock
  code={`# .github/workflows/claude-doc-sync.yml
name: Claude Doc Sync

on:
  schedule:
    - cron: '0 9 * * 1'  # 매주 월요일 9시
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write
  issues: write
  id-token: write

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: \${{ secrets.ANTHROPIC_API_KEY }}
          prompt: |
            코드와 문서의 동기화 상태를 확인해주세요:
            1. API 코드와 API 문서 일치 여부
            2. README와 실제 프로젝트 구조 일치 여부
            3. 변경된 코드에 대한 문서 업데이트 필요 여부
            불일치 항목이 있으면 수정 PR을 생성해주세요.`}
  language="yaml"
  filename="claude-doc-sync.yml"
/>

### 5. CI 실패 자동 수정

<CodeBlock
  code={`# .github/workflows/claude-fix-ci.yml
name: Claude Fix CI

on:
  issue_comment:
    types: [created]

permissions:
  contents: write
  pull-requests: write
  issues: write
  id-token: write
  actions: read
  checks: read

jobs:
  fix:
    if: |
      github.event.issue.pull_request &&
      contains(github.event.comment.body, '@claude fix ci')
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: \${{ secrets.ANTHROPIC_API_KEY }}
          # Interactive 모드: @claude fix ci로 트리거`}
  language="yaml"
  filename="claude-fix-ci.yml"
/>

<Callout type="tip" title="CI 수정 활용법">
  PR에서 CI가 실패했을 때 `@claude fix ci`라고 코멘트하면 Claude가 실패 로그를 분석하고 수정 커밋을 자동으로 푸시합니다.
  `actions: read`와 `checks: read` 권한이 필요합니다.
</Callout>

### 6. 테스트 실패 분석

<CodeBlock
  code={`# .github/workflows/claude-test-analysis.yml
name: Claude Test Analysis

on:
  workflow_run:
    workflows: ["CI"]
    types: [completed]

permissions:
  contents: write
  pull-requests: write
  issues: write
  id-token: write
  actions: read

jobs:
  analyze:
    if: \${{ github.event.workflow_run.conclusion == 'failure' }}
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: \${{ secrets.ANTHROPIC_API_KEY }}
          prompt: |
            CI 워크플로우가 실패했습니다.
            테스트 실패 원인을 분석하고:
            1. 실패한 테스트 케이스를 식별
            2. 근본 원인을 파악
            3. 수정 방안을 PR 코멘트로 제시해주세요`}
  language="yaml"
  filename="claude-test-analysis.yml"
/>

### 7. 이슈 중복 감지

<CodeBlock
  code={`# .github/workflows/claude-duplicate-detect.yml
name: Claude Duplicate Detection

on:
  issues:
    types: [opened]

permissions:
  contents: read
  issues: write
  id-token: write

jobs:
  detect:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: \${{ secrets.ANTHROPIC_API_KEY }}
          prompt: |
            새로 생성된 이슈와 기존 열린 이슈들을 비교하여
            중복 가능성이 있는 이슈를 찾아주세요.
            중복이 발견되면 관련 이슈 번호를 언급하고
            'duplicate' 라벨을 추가해주세요.
          claude_args: "--max-turns 5 --allowedTools Read,Bash(gh issue list),Bash(gh issue view)"`}
  language="yaml"
  filename="claude-duplicate-detect.yml"
/>

### 8. 필터링된 PR 리뷰 (특정 경로만)

<CodeBlock
  code={`# .github/workflows/claude-filtered-review.yml
name: Claude Filtered Review

on:
  pull_request:
    types: [opened, synchronize]
    paths:
      - 'src/**'
      - '!src/**/*.test.*'
      - '!src/**/*.spec.*'

permissions:
  contents: write
  pull-requests: write
  issues: write
  id-token: write

jobs:
  review:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: \${{ secrets.ANTHROPIC_API_KEY }}
          prompt: |
            src/ 디렉토리의 프로덕션 코드 변경사항만 리뷰해주세요.
            테스트 파일은 제외합니다.
            아키텍처 패턴 준수와 보안을 중점 확인해주세요.`}
  language="yaml"
  filename="claude-filtered-review.yml"
/>

### 9. 수동 코드 분석 (workflow_dispatch)

<CodeBlock
  code={`# .github/workflows/claude-analysis.yml
name: Claude Code Analysis

on:
  workflow_dispatch:
    inputs:
      analysis_type:
        description: '분석 유형'
        required: true
        type: choice
        options:
          - security
          - performance
          - architecture
          - dependencies
      target_path:
        description: '분석 대상 경로'
        required: false
        default: 'src/'

permissions:
  contents: write
  pull-requests: write
  issues: write
  id-token: write

jobs:
  analyze:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: \${{ secrets.ANTHROPIC_API_KEY }}
          prompt: |
            \${{ github.event.inputs.target_path }} 경로의 코드를
            \${{ github.event.inputs.analysis_type }} 관점에서 분석하고
            분석 결과를 이슈로 생성해주세요.`}
  language="yaml"
  filename="claude-analysis.yml"
/>

<MermaidDiagram
  chart={`flowchart TB
    subgraph TRIGGER["🎯 트리거"]
      PR["PR 생성/업데이트"]
      ISSUE["이슈 생성"]
      COMMENT["@claude 멘션"]
      SCHED["스케줄 (주간)"]
      CI_FAIL["CI 실패"]
      MANUAL["수동 실행"]
    end
    subgraph CLAUDE["🤖 Claude Actions (9개 워크플로우)"]
      REVIEW["PR Review\n코드 리뷰"]
      TRIAGE["Issue Triage\n자동 분류"]
      SUGGEST["Code Suggest\n개선 제안"]
      DOCSYNC["Doc Sync\n문서 동기화"]
      FIXCI["Fix CI\nCI 수정"]
      TESTANA["Test Analysis\n테스트 분석"]
      DUPDET["Duplicate Detect\n중복 감지"]
      FILTERED["Filtered Review\n경로별 리뷰"]
      ANALYSIS["Code Analysis\n코드 분석"]
    end
    subgraph OUTPUT["📋 산출물"]
      RC["리뷰 코멘트"]
      LB["라벨, 담당자"]
      SC["제안 코멘트"]
      SR["동기화 리포트/PR"]
      FC["수정 커밋"]
      AR["분석 리포트"]
    end
    PR --> REVIEW --> RC
    PR --> SUGGEST --> SC
    PR --> FILTERED --> RC
    ISSUE --> TRIAGE --> LB
    ISSUE --> DUPDET --> LB
    SCHED --> DOCSYNC --> SR
    COMMENT --> FIXCI --> FC
    CI_FAIL --> TESTANA --> AR
    MANUAL --> ANALYSIS --> AR
    style TRIGGER fill:#f0ece5,stroke:#8c857c,color:#2d2a26
    style CLAUDE fill:#fdf2ee,stroke:#da7756,color:#2d2a26
    style OUTPUT fill:#f0ece5,stroke:#16a34a,color:#2d2a26`}
  title="Claude GitHub Actions 전체 파이프라인"
  caption="6가지 트리거 → 9개 워크플로우 → 다양한 산출물"
/>

## PR 코멘트 결과 예시

claude-code-action이 PR에 남기는 리뷰 코멘트의 실제 모습입니다:

<div style={{ margin: '24px 0', padding: '16px', backgroundColor: '#faf9f7', borderRadius: '8px', border: '1px solid #e0d9cf' }}>
  <p style={{ fontSize: '14px', color: '#5c564e', marginBottom: '12px', fontWeight: 600 }}>claude-code-action PR 코멘트 예시</p>
  <img
    src={prCommentImg}
    alt="claude-code-action이 PR에 남긴 리뷰 코멘트 예시. 코드 변경에 대한 분석, 개선 제안, 보안 검토 내용이 포함되어 있습니다."
    style={{ width: '100%', borderRadius: '6px', border: '1px solid #e0d9cf' }}
  />
</div>

## 모범 사례

### CLAUDE.md 연동

프로젝트 루트에 `CLAUDE.md`를 배치하면 claude-code-action이 자동으로 인식합니다. GitHub Actions에 특화된 지시사항을 추가하세요:

<CodeBlock
  code={`# CLAUDE.md (GitHub Actions 관련 섹션 예시)

## PR 리뷰 가이드라인
- 보안 취약점은 반드시 지적할 것
- OWASP Top 10 기준으로 체크
- 새로운 의존성 추가 시 라이선스 확인

## 코딩 컨벤션
- Conventional Commits 사용
- 함수 최대 30줄
- 테스트 커버리지 80% 이상 유지

## 이슈 분류 기준
- P0: 서비스 장애, 보안 취약점
- P1: 주요 기능 버그
- P2: 사소한 버그, UX 개선
- P3: 기능 요청, 리팩토링`}
  language="markdown"
  filename="CLAUDE.md"
/>

### 비용 제어

<Callout type="warning" title="비용 관리 전략">
  claude-code-action은 API 호출 비용이 발생합니다. 다음 전략으로 비용을 관리하세요.
</Callout>

- **max_turns 제한**: `claude_args: "--max-turns 10"`으로 에이전트 턴 수 제한
- **모델 선택**: 간단한 작업에는 Sonnet 계열, 복잡한 작업에만 Opus 계열 사용
- **경로 필터링**: `paths` 트리거로 불필요한 파일 변경 시 실행 방지
- **트리거 조건**: `if` 조건으로 특정 상황에서만 실행
- **job timeout-minutes**: GitHub Actions의 `timeout-minutes` 설정으로 비정상 실행 방지

### 보안

<Callout type="important" title="보안 체크리스트">
  GitHub Actions에서 Claude를 사용할 때 보안을 반드시 고려하세요.
</Callout>

- **시크릿 관리**: API 키는 반드시 GitHub Secrets에 저장
- **권한 최소화**: `permissions`를 워크플로우에 필요한 최소 범위로 설정
- **도구 제한**: `allowed_tools`로 허용할 도구를 명시적으로 지정
- **포크 PR 주의**: 외부 기여자의 포크 PR에서 시크릿이 노출되지 않도록 주의
- **브랜치 보호**: 메인 브랜치에 직접 푸시하지 않도록 브랜치 보호 규칙 설정

## Beta → v1.0 마이그레이션

v1.0에서는 여러 설정 옵션이 변경되었습니다. 기존 Beta 버전 사용자는 다음 매핑을 참고하세요:

<ComparisonTable
  title="Beta → v1.0 변경사항"
  headers={['항목', 'Beta (v0.x)', 'v1.0']}
  rows={[
    { feature: '모드 설정', values: ['mode: "interactive" | "automation"', '자동 감지 (prompt 유무)'] },
    { feature: '프롬프트', values: ['direct_prompt', 'prompt'] },
    { feature: 'CLI 인자', values: ['max_turns, model (개별 옵션)', 'claude_args (통합)'] },
    { feature: '트리거 문구', values: ['trigger_comment', 'trigger_phrase'] },
    { feature: '할당 트리거', values: ['없음', 'assignee_trigger (신규)'] },
    { feature: '라벨 트리거', values: ['없음', 'label_trigger (신규)'] },
    { feature: 'MCP 설정', values: ['없음', 'mcp_config (신규)'] },
    { feature: '구조화 출력', values: ['없음', 'claude_args --json-schema (신규)'] },
    { feature: 'Action 참조', values: ['anthropics/claude-code-action@beta', 'anthropics/claude-code-action@v1'] },
  ]}
/>

## 기타 CI/CD 워크플로우

| 워크플로우 | 트리거 | 역할 |
|-----------|--------|------|
| `ci.yml` | Push, PR | 린트, 테스트, 타입 체크 |
| `cd.yml` | main 머지 | 자동 배포 |
| `security-scan.yml` | 스케줄 | 의존성 보안 취약점 검사 |
| `release.yml` | 태그 생성 | 릴리스 자동화 |
| `rollback.yml` | 수동 | 배포 롤백 |
| `labeler.yml` | PR | 자동 라벨링 |
| `stale.yml` | 스케줄 | 오래된 이슈/PR 처리 |

<ChapterNav
  prev={{ title: 'MCP 서버 활용', path: '/docs/part-4--확장과-자동화-mcp-서버-활용' }}
  next={{ title: 'Agent SDK와 자동화', path: '/docs/part-4--확장과-자동화-agent-sdk와-자동화' }}
/>

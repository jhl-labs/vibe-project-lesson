import { Meta } from '@storybook/addon-docs/blocks';
import { Callout } from '../../components/Callout';
import { CodeBlock } from '../../components/CodeBlock';
import { FileTree } from '../../components/FileTree';
import { TemplateFileViewer } from '../../components/TemplateFileViewer';
import { Quiz } from '../../components/Quiz';
import { ChapterNav } from '../../components/ChapterNav';
import { templateFiles } from '../../data/template-files';

<Meta title="Part 1: 기초/CLAUDE.md 딥다이브" />

# CLAUDE.md 딥다이브

> Claude Code의 행동을 정의하는 프로젝트 지침서

## CLAUDE.md란?

`CLAUDE.md`는 Claude Code가 대화 시작 시 **자동으로 로드하는 지침서**입니다. 프로젝트의 규칙, 컨벤션, 기술 스택, 보안 정책 등을 정의하여 Claude가 프로젝트에 맞는 코드를 생성하도록 안내합니다.

<Callout type="important" title="핵심">
  CLAUDE.md는 Claude Code에게 "이 프로젝트에서는 이렇게 해라"라고 알려주는 설정 파일입니다.
  잘 작성된 CLAUDE.md는 AI의 코드 품질을 크게 향상시킵니다.
</Callout>

## 자동 로드 메커니즘

Claude Code는 다음 순서로 CLAUDE.md 파일을 찾아 로드합니다:

### 계층 구조

<FileTree
  title="CLAUDE.md 탐색 순서"
  data={[
    {
      name: '~/.claude/',
      type: 'folder',
      children: [
        { name: 'CLAUDE.md', type: 'file', description: '글로벌 설정 (모든 프로젝트)', highlight: true },
      ],
    },
    {
      name: 'project-root/',
      type: 'folder',
      children: [
        { name: 'CLAUDE.md', type: 'file', description: '프로젝트 설정 (Git 추적)', highlight: true },
        { name: 'CLAUDE.local.md', type: 'file', description: '개인 설정 (.gitignore)', highlight: true },
        {
          name: '.claude/',
          type: 'folder',
          children: [
            { name: 'CLAUDE.md', type: 'file', description: '대체 위치 (프로젝트 설정)' },
          ],
        },
      ],
    },
  ]}
/>

### 적용 우선순위

| 순서 | 파일 | 범위 | Git 추적 |
|------|------|------|----------|
| 1 | `~/.claude/CLAUDE.md` | 모든 프로젝트 | X |
| 2 | `CLAUDE.md` (프로젝트 루트) | 현재 프로젝트 | O |
| 3 | `CLAUDE.local.md` | 현재 프로젝트 (개인) | X |

<Callout type="tip" title="팁">
  - 글로벌 설정에는 언어 선호도, 공통 스타일 등을 설정하세요
  - 프로젝트 설정에는 기술 스택, 아키텍처, 보안 정책을 설정하세요
  - 개인 설정(CLAUDE.local.md)은 .gitignore에 추가하세요
</Callout>

## 실제 CLAUDE.md 분석

이 프로젝트의 실제 CLAUDE.md 파일을 살펴보겠습니다:

<TemplateFileViewer
  filename="CLAUDE.md"
  content={templateFiles['CLAUDE.md']}
  language="markdown"
  annotations={[
    { lineStart: 1, lineEnd: 8, text: '프로젝트 기본 정보를 정의합니다. Claude가 프로젝트의 이름, 설명, 기술 스택을 파악하는 데 사용됩니다.' },
    { lineStart: 10, lineEnd: 19, text: '빠른 명령어 섹션입니다. Claude가 빌드, 테스트, 린트 등의 명령어를 알 수 있게 합니다.' },
    { lineStart: 21, lineEnd: 29, text: '프로젝트 디렉토리 구조를 설명합니다. Clean Architecture 4레이어를 정의하고 있습니다.' },
    { lineStart: 31, lineEnd: 49, text: '코딩 규칙 섹션입니다. 네이밍, 스타일, 아키텍처 원칙을 정의하여 일관된 코드 생성을 유도합니다.' },
    { lineStart: 51, lineEnd: 65, text: '보안 필수 사항입니다. 절대 금지 항목과 필수 항목을 명확히 구분하여 AI가 안전한 코드를 생성하도록 합니다.' },
    { lineStart: 67, lineEnd: 80, text: 'AI 작업 지침입니다. 코드 생성과 리뷰 시 Claude가 따라야 할 규칙을 정의합니다.' },
  ]}
/>

## CLAUDE.md 작성 모범 사례

### 1. 간결하게 유지

<CodeBlock
  code={`# Good - 명확하고 간결
## 기술 스택
- TypeScript 5.x (strict mode)
- Express.js 4.x
- PostgreSQL 15
- Jest (테스트)

# Bad - 너무 장황
## 기술 스택
이 프로젝트는 TypeScript를 사용합니다. TypeScript는 
JavaScript의 상위 집합으로... (이하 생략)`}
  language="markdown"
  filename="작성 예시"
/>

### 2. 규칙은 구체적으로

<CodeBlock
  code={`# Good - 구체적인 규칙
- 함수 최대 길이: 30줄
- 파라미터 최대: 3개
- 파일명: kebab-case.ts
- 상수: UPPER_SNAKE_CASE

# Bad - 모호한 규칙  
- 깨끗한 코드를 작성하세요
- 좋은 네이밍을 사용하세요`}
  language="markdown"
  filename="규칙 작성 예시"
/>

### 3. 보안 규칙은 반드시 포함

<CodeBlock
  code={`## 보안 필수 사항

**절대 금지:**
- 하드코딩된 시크릿 (API 키, 비밀번호)
- eval() 또는 동적 코드 실행
- 검증 없는 사용자 입력 사용
- SQL 인젝션 가능한 쿼리

**필수:**
- 환경 변수로 설정 관리
- 모든 입력 검증
- 적절한 에러 처리`}
  language="markdown"
  filename="보안 규칙 예시"
/>

### 4. 참조 파일 연결

<CodeBlock
  code={`## 참고 문서
- \`.agent/context.md\` - 상세 프로젝트 컨텍스트
- \`.agent/conventions.md\` - 코딩 컨벤션 상세
- \`docs/adr/\` - 아키텍처 결정 기록`}
  language="markdown"
  filename="참조 파일 예시"
/>

<Callout type="info" title="/init 명령어">
  Claude Code에서 `/init` 명령어를 실행하면 현재 프로젝트를 분석하여 CLAUDE.md를 자동 생성합니다.
  이를 기반으로 프로젝트에 맞게 수정하세요.
</Callout>

<Quiz
  title="CLAUDE.md 이해도 확인"
  questions={[
    {
      question: 'CLAUDE.md의 주요 역할은?',
      options: ['코드 자동완성 설정', '프로젝트 빌드 설정', 'Claude Code에게 프로젝트 규칙을 알려주는 지침서', '테스트 설정 파일'],
      correctIndex: 2,
      explanation: 'CLAUDE.md는 Claude Code가 자동으로 로드하여 프로젝트의 규칙, 컨벤션, 보안 정책 등을 이해하는 지침서입니다.',
    },
    {
      question: '개인 설정을 저장하기 위한 파일은?',
      options: ['CLAUDE.md', 'CLAUDE.local.md', '.claude/CLAUDE.md', '~/.claude/CLAUDE.md'],
      correctIndex: 1,
      explanation: 'CLAUDE.local.md는 프로젝트 내 개인 설정을 저장하는 파일로, .gitignore에 추가하여 Git 추적에서 제외합니다.',
    },
    {
      question: 'CLAUDE.md 작성 시 가장 중요한 원칙은?',
      options: ['가능한 길게 작성', '간결하고 구체적으로 작성', '영어로만 작성', '매일 업데이트'],
      correctIndex: 1,
      explanation: 'CLAUDE.md의 모든 줄은 AI의 주의를 경쟁하므로, 간결하면서도 구체적인 규칙을 작성하는 것이 중요합니다.',
    },
  ]}
/>

<ChapterNav
  prev={{ title: 'Claude Code란?', path: '/docs/part-1--기초-claude-code란' }}
  next={{ title: '.agent 디렉토리 개요', path: '/docs/part-2--프로젝트-템플릿-구조-agent-디렉토리-개요' }}
/>

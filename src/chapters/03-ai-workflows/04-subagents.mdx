import { Meta } from '@storybook/addon-docs/blocks';
import { Callout } from '../../components/Callout';
import { CodeBlock } from '../../components/CodeBlock';
import { ComparisonTable } from '../../components/ComparisonTable';
import { MermaidDiagram } from '../../components/MermaidDiagram';
import { ChapterNav } from '../../components/ChapterNav';

<Meta title="Part 3: AI Agent 워크플로우/서브에이전트" />

# 서브에이전트 (Subagents)

> 전문 분야별 AI 에이전트 시스템

## 개요

서브에이전트는 **전문 분야별 AI 에이전트**입니다. Claude Code는 내부적으로 Task 도구를 통해 서브에이전트를 생성하며, 각 서브에이전트는 독립된 컨텍스트에서 작업을 수행합니다. `.agent/subagents/` 디렉토리에 역할별 정의를 저장하여 일관된 전문성을 유지합니다. Anthropic은 대화 초반에 서브에이전트를 적극 활용하여 컨텍스트를 보존하면서 세부 작업을 병렬 처리할 것을 권장합니다.

<Callout type="info" title="핵심 개념">
  서브에이전트는 "한 명의 전문가"와 같습니다.
  아키텍트, 보안 전문가, 테스터, 테크니컬 라이터 — 각각의 전문성을 가진 AI 에이전트가 협력합니다.
</Callout>

## 4개 서브에이전트

<ComparisonTable
  title="서브에이전트 비교"
  headers={['항목', 'Architect', 'Security', 'Test', 'Documentation']}
  rows={[
    { feature: '전문 분야', values: ['시스템 설계', '보안 분석', '테스트 전략', '기술 문서'] },
    { feature: '주요 산출물', values: ['ADR, 설계안', '취약점 리포트', '테스트 코드', 'API 문서'] },
    { feature: '참조 지식', values: ['아키텍처 패턴', 'OWASP Top 10', '테스트 피라미드', '문서 표준'] },
    { feature: '활용 시점', values: ['설계/기술 결정', '보안 검토', '테스트 작성', '문서화'] },
  ]}
/>

## Architect 서브에이전트

### 역할
- 시스템 설계 및 기술 의사결정
- 아키텍처 검토 및 개선
- ADR (Architecture Decision Record) 작성
- 기술 스택 평가

### 분석 프레임워크

<CodeBlock
  code={`## 아키텍처 분석

### 컴포넌트 맵
- 현재 시스템 구성 분석
- 의존성 그래프 작성
- 병목 지점 식별

### SWOT 분석
- Strengths: 현재 아키텍처의 강점
- Weaknesses: 개선이 필요한 부분
- Opportunities: 활용 가능한 기술/패턴
- Threats: 잠재적 위험 요소

### 기술 선정 매트릭스
| 기준 | 가중치 | 옵션 A | 옵션 B |
|------|--------|--------|--------|
| 성능 | 30% | 8/10 | 7/10 |
| 확장성 | 25% | 9/10 | 6/10 |
| 학습 곡선 | 20% | 5/10 | 8/10 |
| 커뮤니티 | 15% | 7/10 | 9/10 |
| 비용 | 10% | 6/10 | 8/10 |`}
  language="markdown"
  filename="Architect 분석 프레임워크"
/>

## Security 서브에이전트

### 역할
- 보안 코드 리뷰
- 취약점 분석 (OWASP Top 10)
- 보안 권고 및 수정 제안
- 보안 문서화

### 취약점 분석 출력 형식

<CodeBlock
  code={`## 보안 분석 리포트

### 취약점 #1: SQL Injection
- 심각도: 🔴 Critical
- 위치: src/api/users.ts:45
- 설명: 사용자 입력이 SQL 쿼리에 직접 사용
- 영향: 데이터 유출, 데이터 조작 가능
- 수정 권고:
  - 파라미터화된 쿼리 사용
  - ORM의 빌트인 이스케이프 활용
- 참고: OWASP A03:2021`}
  language="markdown"
  filename="Security 리포트 예시"
/>

## Test 서브에이전트

### 역할
- 테스트 전략 수립
- 테스트 코드 생성 (단위/통합/E2E)
- 테스트 리뷰 및 개선
- 커버리지 분석

## Documentation 서브에이전트

### 역할
- API 문서 작성 (REST, GraphQL)
- 코드 문서 생성 (JSDoc, Docstring)
- README 구조화
- 코드-문서 동기화 검증

## 서브에이전트 활용 패턴

### 서브에이전트 오케스트레이션

<MermaidDiagram
  chart={`sequenceDiagram
    participant D as 👤 개발자
    participant A as 🏛️ Architect
    participant S as 🔒 Security
    participant T as 🧪 Test
    participant DOC as 📝 Documentation
    D->>A: 1. 설계 검토 요청
    A-->>D: ADR, 설계안
    Note over D: 설계 승인 후 병렬 실행
    par 병렬 실행
      D->>S: 2a. 보안 분석
      S-->>D: 취약점 리포트
    and
      D->>T: 2b. 테스트 전략
      T-->>D: 테스트 코드
    and
      D->>DOC: 2c. 문서 초안
      DOC-->>D: API 문서
    end
    Note over D: 3. 종합 검토 후 구현`}
  title="서브에이전트 오케스트레이션 패턴"
  caption="Architect의 설계 검토 후, Security/Test/Documentation이 병렬로 실행됩니다"
/>

### 격리된 컨텍스트

<Callout type="warning" title="중요">
  각 서브에이전트는 **격리된 컨텍스트**에서 작동합니다.
  하나의 서브에이전트가 다른 서브에이전트의 작업 결과를 직접 참조하지 않으며,
  개발자가 결과를 종합하여 최종 판단합니다.
</Callout>

<Callout type="tip" title="서브에이전트 권한 제어">
  엔터프라이즈 환경에서는 Managed Settings의 deny 규칙으로 특정 서브에이전트를 차단할 수 있습니다.
  예: `"deny": ["Task(Explore)", "Task(Plan)"]`
</Callout>

<ChapterNav
  prev={{ title: '스킬', path: '/docs/part-3--ai-agent-워크플로우-스킬' }}
  next={{ title: 'MCP 개요', path: '/docs/part-4--mcp와-통합-mcp-개요' }}
/>

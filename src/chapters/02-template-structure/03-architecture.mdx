import { Meta } from '@storybook/addon-docs/blocks';
import { Callout } from '../../components/Callout';
import { CodeBlock } from '../../components/CodeBlock';
import { TemplateFileViewer } from '../../components/TemplateFileViewer';
import { ComparisonTable } from '../../components/ComparisonTable';
import { MermaidDiagram } from '../../components/MermaidDiagram';
import { ChapterNav } from '../../components/ChapterNav';
import { templateFiles } from '../../data/template-files';

<Meta title="Part 2: í”„ë¡œì íŠ¸ í…œí”Œë¦¿ êµ¬ì¡°/ì•„í‚¤í…ì²˜" />

# ì•„í‚¤í…ì²˜

> Clean Architecture ì›ì¹™ì„ ì‹¤ë¬´ì— ì ìš©í•œ 4ë ˆì´ì–´ ì„¤ê³„

## ì•„í‚¤í…ì²˜ ì›ì¹™

<Callout type="info" title="ì›ì „ê³¼ ì‹¤ë¬´ ì ìš©ì˜ ì°¨ì´">
  Robert C. Martinì˜ Clean Architecture ì›ì„œ(2017)ëŠ” Entities, Use Cases, Interface Adapters, Frameworks & Driversì˜ 4ê°œ ë™ì‹¬ì› êµ¬ì¡°ë¥¼ ì œì•ˆí•©ë‹ˆë‹¤.
  í•µì‹¬ì€ **Dependency Rule**(ì˜ì¡´ì„±ì€ í•­ìƒ ì•ˆìª½ì„ í–¥í•œë‹¤)ê³¼ **SOLID ì›ì¹™**ì…ë‹ˆë‹¤.
  ì´ í”„ë¡œì íŠ¸ í…œí”Œë¦¿ì€ í•´ë‹¹ ì›ì¹™ì„ ì‹¤ë¬´ì— ì ìš©í•˜ì—¬ Presentation, Application, Domain, Infrastructure 4ë ˆì´ì–´ë¡œ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.
</Callout>

ì´ í”„ë¡œì íŠ¸ í…œí”Œë¦¿ì€ Clean Architectureì˜ **Dependency Rule**ì„ ì¤‘ì‹¬ìœ¼ë¡œ, ë‹¤ìŒ 4ê°€ì§€ ì„¤ê³„ ì›ì¹™ì„ ì±„íƒí•©ë‹ˆë‹¤:

| ì›ì¹™ | ì„¤ëª… | ê·¼ê±° |
|------|------|------|
| **ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬** | ê° ë ˆì´ì–´/ëª¨ë“ˆì€ ëª…í™•í•œ ì±…ì„ì„ ê°€ì§ | Clean Architecture í•µì‹¬ ì›ì¹™ |
| **ì˜ì¡´ì„± ì—­ì „** | ê³ ìˆ˜ì¤€ ëª¨ë“ˆì´ ì €ìˆ˜ì¤€ ëª¨ë“ˆì— ì˜ì¡´í•˜ì§€ ì•ŠìŒ | SOLIDì˜ DIP ì›ì¹™ |
| **ë‹¨ì¼ ì§„ì‹¤ ê³µê¸‰ì›** | ê° ë°ì´í„°ëŠ” í•˜ë‚˜ì˜ ìœ„ì¹˜ì—ì„œë§Œ ê´€ë¦¬ | ì¼ë°˜ ì†Œí”„íŠ¸ì›¨ì–´ ê³µí•™ ì›ì¹™ |
| **ì‹¤íŒ¨ë¥¼ ìœ„í•œ ì„¤ê³„** | ëª¨ë“  ì™¸ë¶€ í˜¸ì¶œì€ ì‹¤íŒ¨í•  ìˆ˜ ìˆìŒì„ ê°€ì • | ë¶„ì‚° ì‹œìŠ¤í…œ ì„¤ê³„ ì›ì¹™ |

## 4ë ˆì´ì–´ êµ¬ì¡°

<MermaidDiagram
  chart={`flowchart TB
    subgraph PL["ğŸŒ Presentation Layer"]
      REST["REST API"]
      GraphQL["GraphQL API"]
      gRPC["gRPC Service"]
    end
    subgraph AL["âš™ï¸ Application Layer"]
      UC["Use Cases"]
      AS["Application Services"]
    end
    subgraph DL["ğŸ’ Domain Layer"]
      E["Entities"]
      VO["Value Objects"]
      DS["Domain Services"]
    end
    subgraph IL["ğŸ”§ Infrastructure Layer"]
      Repo["Repository"]
      ExtAPI["External APIs"]
      MQ["Message Queue"]
      Cache["Cache"]
    end
    PL --> AL
    AL --> DL
    IL --> DL
    style PL fill:#fdf2ee,stroke:#da7756,color:#2d2a26
    style AL fill:#fdf2ee,stroke:#9333ea,color:#2d2a26
    style DL fill:#fdf2ee,stroke:#16a34a,color:#2d2a26
    style IL fill:#fdf2ee,stroke:#d97706,color:#2d2a26`}
  title="Clean Architecture 4ë ˆì´ì–´"
  caption="ì˜ì¡´ì„±ì€ í•­ìƒ ì•ˆìª½(Domain)ì„ í–¥í•©ë‹ˆë‹¤. InfrastructureëŠ” Domainì— ì˜ì¡´í•©ë‹ˆë‹¤."
/>

<Callout type="important" title="ì˜ì¡´ì„± ë°©í–¥">
  ì˜ì¡´ì„±ì€ í•­ìƒ ì•ˆìª½(Domain)ì„ í–¥í•©ë‹ˆë‹¤:
  Presentation â†’ Application â†’ Domain â† Infrastructure
</Callout>

## ë ˆì´ì–´ë³„ ì±…ì„

<ComparisonTable
  title="ë ˆì´ì–´ë³„ ì—­í•  ë¹„êµ"
  headers={['í•­ëª©', 'Presentation', 'Application', 'Domain', 'Infrastructure']}
  rows={[
    { feature: 'HTTP ì²˜ë¦¬', values: ['yes', 'no', 'no', 'no'] },
    { feature: 'ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§', values: ['no', 'no', 'yes', 'no'] },
    { feature: 'ìœ ìŠ¤ì¼€ì´ìŠ¤ ì¡°í•©', values: ['no', 'yes', 'no', 'no'] },
    { feature: 'DB ì ‘ê·¼', values: ['no', 'no', 'no', 'yes'] },
    { feature: 'ì…ë ¥ ê²€ì¦', values: ['yes', 'no', 'no', 'no'] },
    { feature: 'íŠ¸ëœì­ì…˜ ê´€ë¦¬', values: ['no', 'yes', 'no', 'no'] },
    { feature: 'ì™¸ë¶€ API í˜¸ì¶œ', values: ['no', 'no', 'no', 'yes'] },
    { feature: 'ë„ë©”ì¸ ì´ë²¤íŠ¸', values: ['no', 'partial', 'yes', 'no'] },
  ]}
/>

## ë°ì´í„° íë¦„

<MermaidDiagram
  chart={`sequenceDiagram
    participant C as ğŸ–¥ï¸ Client
    participant CT as Controller
    participant UC as Use Case
    participant DS as Domain Service
    participant R as Repository
    participant DB as ğŸ’¾ Database
    C->>CT: HTTP Request
    Note right of CT: ì…ë ¥ ê²€ì¦, ì¸ì¦ í™•ì¸, DTO ë³€í™˜
    CT->>UC: Command/Query
    Note right of UC: ë¹„ì¦ˆë‹ˆìŠ¤ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜, íŠ¸ëœì­ì…˜ ê²½ê³„
    UC->>DS: ë„ë©”ì¸ ë©”ì„œë“œ í˜¸ì¶œ
    Note right of DS: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì‹¤í–‰, ê·œì¹™ ê°•ì œ
    DS->>R: ë°ì´í„° ì ‘ê·¼
    Note right of R: ë°ì´í„° ì˜ì†í™”
    R->>DB: SQL Query
    DB-->>R: Result Set
    R-->>DS: Entity
    DS-->>UC: Domain Result
    UC-->>CT: Response DTO
    CT-->>C: HTTP Response`}
  title="ìš”ì²­ ì²˜ë¦¬ ë°ì´í„° íë¦„"
  caption="í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì´ ê° ë ˆì´ì–´ë¥¼ ê±°ì³ ì²˜ë¦¬ë˜ëŠ” ê³¼ì •"
/>

## ì‹¤ì œ architecture.md íŒŒì¼

<TemplateFileViewer
  filename=".agent/architecture.md"
  content={templateFiles['.agent/architecture.md']}
  language="markdown"
  annotations={[
    { lineStart: 1, lineEnd: 24, text: 'ì•„í‚¤í…ì²˜ ì›ì¹™ ì„¹ì…˜ì…ë‹ˆë‹¤. 4ê°€ì§€ í•µì‹¬ ì›ì¹™(ê´€ì‹¬ì‚¬ ë¶„ë¦¬, ì˜ì¡´ì„± ì—­ì „, ë‹¨ì¼ ì§„ì‹¤ ê³µê¸‰ì›, ì‹¤íŒ¨ë¥¼ ìœ„í•œ ì„¤ê³„)ì„ ì •ì˜í•©ë‹ˆë‹¤.' },
    { lineStart: 26, lineEnd: 67, text: 'ë ˆì´ì–´ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨ì…ë‹ˆë‹¤. ASCII ì•„íŠ¸ë¡œ Presentation, Application, Domain, Infrastructure 4ê°œ ë ˆì´ì–´ë¥¼ ì‹œê°ì ìœ¼ë¡œ í‘œí˜„í•©ë‹ˆë‹¤.' },
    { lineStart: 69, lineEnd: 97, text: 'Presentation Layer ìƒì„¸ì…ë‹ˆë‹¤. HTTP ì²˜ë¦¬, ì…ë ¥ ê²€ì¦, ì¸ì¦/ì¸ê°€, DTO ë³€í™˜ì˜ ì±…ì„ê³¼ ì½”ë“œ ì˜ˆì œë¥¼ í¬í•¨í•©ë‹ˆë‹¤.' },
    { lineStart: 99, lineEnd: 130, text: 'Application Layer ìƒì„¸ì…ë‹ˆë‹¤. ìœ ìŠ¤ì¼€ì´ìŠ¤ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜, íŠ¸ëœì­ì…˜ ê´€ë¦¬, ì´ë²¤íŠ¸ ë°œí–‰ì˜ ì—­í• ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.' },
    { lineStart: 132, lineEnd: 176, text: 'Domain Layer ìƒì„¸ì…ë‹ˆë‹¤. ì—”í„°í‹°, ê°’ ê°ì²´, ë„ë©”ì¸ ì„œë¹„ìŠ¤ì˜ êµ¬í˜„ ì˜ˆì œë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤. ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì˜ í•µì‹¬ì…ë‹ˆë‹¤.' },
    { lineStart: 178, lineEnd: 216, text: 'Infrastructure Layer ìƒì„¸ì…ë‹ˆë‹¤. Repository êµ¬í˜„, ì™¸ë¶€ API í´ë¼ì´ì–¸íŠ¸, DB ì„¤ì • ë“± ê¸°ìˆ ì  êµ¬í˜„ì²´ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.' },
  ]}
/>


<ChapterNav
  prev={{ title: 'ì»¨í…ìŠ¤íŠ¸ì™€ ì»¨ë²¤ì…˜', path: '/docs/part-2--í”„ë¡œì íŠ¸-í…œí”Œë¦¿-êµ¬ì¡°-ì»¨í…ìŠ¤íŠ¸ì™€-ì»¨ë²¤ì…˜' }}
  next={{ title: 'ê°€ì´ë“œë¼ì¸', path: '/docs/part-2--í”„ë¡œì íŠ¸-í…œí”Œë¦¿-êµ¬ì¡°-ê°€ì´ë“œë¼ì¸' }}
/>

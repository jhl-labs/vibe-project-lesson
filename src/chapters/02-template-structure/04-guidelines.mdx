import { Meta } from '@storybook/addon-docs/blocks';
import { Callout } from '../../components/Callout';
import { CodeBlock } from '../../components/CodeBlock';
import { ComparisonTable } from '../../components/ComparisonTable';
import { MermaidDiagram } from '../../components/MermaidDiagram';
import { Timeline } from '../../components/Timeline';
import { ChapterNav } from '../../components/ChapterNav';

<Meta title="Part 2: 프로젝트 템플릿 구조/가이드라인" />

# 가이드라인

> AI 에이전트 사용의 원칙과 규칙을 `.claude/rules/`에 정의하는 방법

AI 에이전트가 코드 생성의 핵심 도구로 자리잡으면서, "AI를 어떻게 사용할 것인가"에 대한 체계적인 규칙이 필수가 되었습니다.
가이드라인은 단순한 문서가 아니라, 팀의 **보안**, **품질**, **일관성**을 지키는 방어선입니다.
이 챕터에서는 가이드라인의 필요성부터 실전 적용, 자동화, 감사(Audit)까지 전 과정을 다룹니다.

---

## 가이드라인이 필요한 이유

### AI 코드 생성의 양면성

AI 에이전트는 생산성을 극적으로 높여주지만, 동시에 새로운 위험을 만들어냅니다.
가이드라인 없이 AI를 사용하면 다음과 같은 문제가 발생할 수 있습니다:

| 영역 | 위험 | 실제 사례 |
|------|------|----------|
| **보안** | 하드코딩된 시크릿, SQL 인젝션 | AI가 예시 코드에 API 키를 직접 삽입 |
| **품질** | 일관성 없는 코드 스타일 | 팀원마다 AI가 다른 패턴으로 코드 생성 |
| **법률** | 라이선스 위반 코드 복사 | AI가 GPL 코드를 상용 프로젝트에 삽입 |
| **데이터** | 개인정보 유출 | 프로덕션 데이터를 프롬프트에 포함 |
| **아키텍처** | 레이어 경계 위반 | AI가 Controller에 비즈니스 로직 직접 구현 |

### 가이드라인의 3계층 구조

<MermaidDiagram
  chart={`flowchart TB
    subgraph L1["1계층: 문서화된 규칙"]
      R1[".claude/rules/guidelines.md"]
      R2["허용/금지 사항 정의"]
      R3["프롬프트 작성 가이드"]
    end
    subgraph L2["2계층: 권한 설정"]
      P1[".claude/settings.json"]
      P2["도구별 allow/deny"]
      P3["경로별 접근 제어"]
    end
    subgraph L3["3계층: 자동 검증"]
      H1["Hooks 시스템"]
      H2["PreToolUse/PostToolUse"]
      H3["CI/CD 파이프라인"]
    end
    L1 --> L2
    L2 --> L3
    style L1 fill:#fdf2ee,stroke:#16a34a,color:#2d2a26
    style L2 fill:#fdf2ee,stroke:#9333ea,color:#2d2a26
    style L3 fill:#fdf2ee,stroke:#da7756,color:#2d2a26`}
  title="가이드라인 3계층 구조"
  caption="문서화된 규칙 -> 권한 설정 -> 자동 검증의 3단계로 AI 사용을 체계적으로 제어합니다."
/>

<Callout type="important" title="가장 중요한 원칙">
  AI 생성 코드의 최종 책임은 커밋한 개발자에게 있습니다.
  "AI가 만들어준 코드"는 면책 사유가 되지 않습니다.
</Callout>

---

## 핵심 원칙

### 책임 소재

AI 에이전트가 아무리 발전해도, 코드를 커밋하고 배포하는 것은 사람의 결정입니다.
이 원칙은 모든 가이드라인의 기반이 됩니다:

- AI가 생성한 코드라도 개발자가 검토하고 커밋하면 해당 개발자의 책임
- 이해하지 못한 코드는 절대 커밋하지 않음
- AI 생성 코드의 동작을 설명할 수 있어야 함

### 검증 절차

<CodeBlock
  code={`AI 코드 생성 → 개발자 검토 → 단위 테스트 → 보안 스캔 → 코드 리뷰 → 머지`}
  language="text"
  filename="AI 코드 검증 파이프라인"
/>

<MermaidDiagram
  chart={`flowchart LR
    A["AI 코드 생성"] --> B["개발자 검토"]
    B --> C{"이해했는가?"}
    C -->|Yes| D["단위 테스트"]
    C -->|No| E["AI에게 설명 요청"]
    E --> B
    D --> F["보안 스캔"]
    F --> G{"취약점?"}
    G -->|No| H["코드 리뷰"]
    G -->|Yes| I["수정 요청"]
    I --> A
    H --> J{"승인?"}
    J -->|Yes| K["머지"]
    J -->|No| L["피드백"]
    L --> A
    style A fill:#fdf2ee,stroke:#9333ea,color:#2d2a26
    style K fill:#fdf2ee,stroke:#16a34a,color:#2d2a26
    style I fill:#fdf2ee,stroke:#dc2626,color:#2d2a26`}
  title="AI 코드 검증 흐름"
  caption="AI 생성 코드는 반드시 이해 -> 테스트 -> 보안 -> 리뷰의 과정을 거쳐야 합니다."
/>

---

## 가이드라인을 .claude/rules/에 문서화하기

허용/금지 사항을 `.claude/rules/guidelines.md`에 정의하면, Claude Code가 코드 생성 시 자동으로 이 규칙을 참조합니다:

<CodeBlock
  code={`# AI 사용 가이드라인

## 허용 사항 (권장)
- 보일러플레이트 코드 생성 → 구조 확인 후 사용
- 테스트 케이스 초안 작성 → 커버리지 검토 필수
- 문서화 보조 → 내용 정확성 검증
- 코드 리뷰 1차 검토 → 보안 중점 확인
- 리팩토링 제안 → 영향도 분석 후 적용

## 금지 사항 (절대 금지)
- 보안 관련 코드 무검증 적용 → 보안 리뷰 필수
- 프로덕션 데이터를 프롬프트에 포함 → 익명화 데이터 사용
- 시크릿/API 키 노출 → 환경 변수로 관리
- 라이선스 불명확한 코드 복사 → 라이선스 확인 필수
- 개인정보(PII) 포함 프롬프트 → PII 제거 후 사용`}
  language="markdown"
  filename=".claude/rules/guidelines.md"
/>

<ComparisonTable
  title="AI 사용 가이드"
  headers={['사용 사례', '허용 여부', '주의사항']}
  rows={[
    { feature: '보일러플레이트 생성', values: ['yes', '구조 확인'] },
    { feature: '테스트 케이스 초안', values: ['yes', '커버리지 검토'] },
    { feature: '문서화 보조', values: ['yes', '내용 검증'] },
    { feature: '코드 리뷰 1차 검토', values: ['yes', '보안 중점'] },
    { feature: '리팩토링 제안', values: ['yes', '영향도 분석'] },
    { feature: '보안 코드 무검증 적용', values: ['no', '보안팀 검토 필수'] },
    { feature: '프로덕션 데이터 프롬프트', values: ['no', '익명화 데이터 사용'] },
    { feature: '시크릿 노출', values: ['no', '환경 변수만'] },
    { feature: '라이선스 불명 코드 복사', values: ['no', '라이선스 확인'] },
    { feature: '개인정보 포함 프롬프트', values: ['no', 'PII 제거'] },
  ]}
/>

---

## Claude Code 권한 모델

Claude Code는 `.claude/settings.json`에서 도구별 권한을 세밀하게 제어합니다.
권한은 `allow` (자동 허용), `deny` (차단), 미지정 (매번 확인) 세 단계로 나뉩니다.

<CodeBlock
  code={`{
  "permissions": {
    "allow": [
      "Bash(npm test)",
      "Bash(npm run lint)",
      "Bash(npm run build)",
      "Read",
      "Glob",
      "Grep"
    ],
    "deny": [
      "Bash(curl*)",
      "Bash(wget*)",
      "Bash(rm -rf /)*"
    ]
  }
}`}
  language="json"
  filename=".claude/settings.json - 권한 설정"
/>

### 권한 규칙 문법

| 패턴 | 의미 | 예시 |
|------|------|------|
| `"ToolName"` | 도구 전체 허용/차단 | `"Read"` - 모든 파일 읽기 허용 |
| `"Bash(pattern)"` | 특정 명령 패턴만 | `"Bash(npm test)"` - npm test만 허용 |
| `"Bash(npm *)"` | 와일드카드 | `"Bash(npm *)"` - npm 명령 전체 허용 |
| `"Edit(src/**)"` | 경로 패턴 | `"Edit(src/**)"` - src/ 내 파일 편집만 허용 |

<Callout type="warning" title="권한 평가 순서">
  `deny`가 `allow`보다 우선합니다. 같은 패턴이 양쪽에 있으면 차단됩니다.
  예: allow에 `"Bash(rm *)"`, deny에 `"Bash(rm -rf *)"` -> `rm -rf`는 차단, 다른 `rm`은 허용.
</Callout>

### 권한 설정 계층 구조

Claude Code는 여러 레벨의 권한 설정을 지원합니다. 상위 레벨이 하위 레벨보다 우선합니다:

<MermaidDiagram
  chart={`flowchart TB
    subgraph E["Enterprise Managed (최우선)"]
      EM["managed-settings.json"]
    end
    subgraph P["Project Settings"]
      PS[".claude/settings.json"]
    end
    subgraph U["User Settings"]
      US[".claude/settings.local.json"]
    end
    E --> P
    P --> U
    style E fill:#fdf2ee,stroke:#dc2626,color:#2d2a26
    style P fill:#fdf2ee,stroke:#d97706,color:#2d2a26
    style U fill:#fdf2ee,stroke:#16a34a,color:#2d2a26`}
  title="권한 설정 우선순위"
  caption="Enterprise > Project > User 순으로 우선합니다. Enterprise에서 deny한 항목은 하위에서 allow할 수 없습니다."
/>

<CodeBlock
  code={`// Enterprise Managed Settings (조직 관리자가 배포)
// macOS: /Library/Application Support/ClaudeCode/managed-settings.json
// Linux: /etc/claude-code/managed-settings.json
{
  "disableBypassPermissionsMode": "disable",
  "permissions": {
    "deny": [
      "Bash(rm -rf *)",
      "Bash(sudo *)",
      "Write(.env)",
      "Write(*.pem)",
      "Write(*.key)"
    ]
  }
}`}
  language="json"
  filename="Enterprise Managed Settings"
/>

### settings.json vs settings.local.json

<ComparisonTable
  title="설정 파일 비교"
  headers={['구분', 'settings.json', 'settings.local.json']}
  rows={[
    { feature: '위치', values: ['.claude/settings.json', '.claude/settings.local.json'] },
    { feature: 'Git 추적', values: ['yes', 'no'] },
    { feature: '용도', values: ['팀 공통 권한 정책', '개인 권한 오버라이드'] },
    { feature: '적용 범위', values: ['팀 전체', '개인만'] },
    { feature: '우선순위', values: ['낮음', '높음 (개인 override)'] },
  ]}
/>

### 도구별 세부 권한 설정 예시

<CodeBlock
  code={`{
  "permissions": {
    "allow": [
      "Read",
      "Glob",
      "Grep",
      "Bash(npm test)",
      "Bash(npm run lint)",
      "Bash(npm run build)",
      "Bash(git status)",
      "Bash(git diff*)",
      "Bash(git log*)",
      "Edit(src/**)",
      "Edit(tests/**)",
      "Write(src/**/*.ts)",
      "Write(tests/**/*.test.ts)"
    ],
    "deny": [
      "Bash(curl*)",
      "Bash(wget*)",
      "Bash(rm -rf *)",
      "Bash(sudo *)",
      "Bash(*production*)",
      "Bash(*deploy*)",
      "Write(.env*)",
      "Write(*.pem)",
      "Write(*.key)",
      "Write(*.secret)",
      "Edit(node_modules/**)",
      "Edit(.git/**)",
      "WebFetch(*internal*)"
    ]
  }
}`}
  language="json"
  filename=".claude/settings.json - 상세 권한 설정 예시"
/>

<Callout type="tip" title="권한 설정 전략">
  처음에는 **최소 권한 원칙(Principle of Least Privilege)**으로 시작하세요.
  필요한 권한만 allow에 추가하고, 나머지는 매번 확인하도록 둡니다.
  팀이 익숙해지면 점진적으로 allow 목록을 확장하세요.
</Callout>

---

## Hooks로 자동 검증 파이프라인 구축

Claude Code의 **Hooks**는 도구 실행 전후에 셸 스크립트를 자동 실행하는 기능입니다.
가이드라인 준수를 코드 수준에서 강제할 수 있습니다.

### Hook 이벤트 유형

| 이벤트 | 실행 시점 | 활용 예시 |
|--------|----------|----------|
| `PreToolUse` | 도구 실행 전 | 위험한 명령 차단, 파일 접근 제한 |
| `PostToolUse` | 도구 실행 후 | 린트 자동 실행, 포맷팅 적용 |
| `Notification` | 알림 발생 시 | 슬랙/디스코드 알림 전송 |
| `Stop` | 에이전트 턴 종료 시 | 자동 테스트 실행, 빌드 검증 |
| `UserPromptSubmit` | 사용자 프롬프트 제출 전 | 민감 정보 필터링 |
| `SubagentStart` | 서브에이전트 시작 시 | 서브에이전트 권한 제한 |

### Hook 설정 예시

<CodeBlock
  code={`{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "npx eslint --fix $CLAUDE_FILE_PATH"
          }
        ]
      }
    ],
    "Stop": [
      {
        "matcher": "",
        "hooks": [
          {
            "type": "command",
            "command": "npm test -- --bail 2>/dev/null"
          }
        ]
      }
    ]
  }
}`}
  language="json"
  filename=".claude/settings.json - Hooks 설정"
/>

<Callout type="tip" title="Hook 종료 코드">
  Hook 스크립트가 **종료 코드 2**를 반환하면 해당 도구 실행이 차단됩니다.
  이를 활용하면 특정 조건에서 Claude의 동작을 프로그래밍적으로 제어할 수 있습니다.
</Callout>

### PreToolUse로 위험 동작 차단

<CodeBlock
  code={`{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "echo $CLAUDE_TOOL_INPUT | jq -r '.command' | grep -qE '(rm -rf /|DROP TABLE|shutdown)' && exit 2 || exit 0"
          }
        ]
      }
    ]
  }
}`}
  language="json"
  filename="위험 명령 차단 Hook"
/>

### PostToolUse로 코드 품질 자동 검증

<CodeBlock
  code={`{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "npx eslint --fix $CLAUDE_FILE_PATH && npx prettier --write $CLAUDE_FILE_PATH"
          }
        ]
      },
      {
        "matcher": "Write",
        "hooks": [
          {
            "type": "command",
            "command": "echo $CLAUDE_FILE_PATH | grep -qE '\\.(env|pem|key|secret)$' && echo 'BLOCKED: Sensitive file creation' && exit 2 || exit 0"
          }
        ]
      }
    ]
  }
}`}
  language="json"
  filename="코드 품질 자동 검증 Hook"
/>

### UserPromptSubmit으로 민감 정보 필터링

<CodeBlock
  code={`{
  "hooks": {
    "UserPromptSubmit": [
      {
        "matcher": "",
        "hooks": [
          {
            "type": "command",
            "command": "echo $CLAUDE_USER_PROMPT | grep -qiE '(password|secret|api.key|token)\\s*[:=]\\s*[A-Za-z0-9]' && echo 'WARNING: 프롬프트에 민감 정보가 포함된 것으로 보입니다' && exit 2 || exit 0"
          }
        ]
      }
    ]
  }
}`}
  language="json"
  filename="민감 정보 필터링 Hook"
/>

### Hook 기반 가이드라인 자동 강제 흐름

<MermaidDiagram
  chart={`flowchart TB
    subgraph Input["입력 단계"]
      UP["사용자 프롬프트"]
      UPS["UserPromptSubmit Hook"]
    end
    subgraph PreExec["실행 전 검증"]
      PTU["PreToolUse Hook"]
      SEC["보안 검사"]
      PATH["경로 검증"]
    end
    subgraph Exec["도구 실행"]
      TOOL["Claude 도구 실행"]
    end
    subgraph PostExec["실행 후 검증"]
      POST["PostToolUse Hook"]
      LINT["린트 검사"]
      FMT["포맷팅"]
    end
    subgraph Final["종료 검증"]
      STOP["Stop Hook"]
      TEST["테스트 실행"]
      BUILD["빌드 검증"]
    end
    UP --> UPS
    UPS -->|통과| PTU
    UPS -->|차단| UP
    PTU --> SEC
    SEC --> PATH
    PATH -->|통과| TOOL
    PATH -->|차단| UP
    TOOL --> POST
    POST --> LINT
    LINT --> FMT
    FMT --> STOP
    STOP --> TEST
    TEST --> BUILD
    style Input fill:#fdf2ee,stroke:#9333ea,color:#2d2a26
    style PreExec fill:#fdf2ee,stroke:#dc2626,color:#2d2a26
    style Exec fill:#fdf2ee,stroke:#3b82f6,color:#2d2a26
    style PostExec fill:#fdf2ee,stroke:#d97706,color:#2d2a26
    style Final fill:#fdf2ee,stroke:#16a34a,color:#2d2a26`}
  title="Hook 기반 가이드라인 자동 강제 흐름"
  caption="프롬프트 입력부터 종료까지 모든 단계에서 Hook이 가이드라인 준수를 자동으로 검증합니다."
/>

---

## 보안 가이드라인 구체화

### 코드 실행 제한

AI 에이전트가 실행할 수 있는 명령어를 명확히 제한해야 합니다:

<CodeBlock
  code={`# .claude/rules/security-guidelines.md

## 코드 실행 제한

### 허용되는 명령
- npm/yarn/pnpm 패키지 관리 명령
- git 조회 명령 (status, diff, log)
- 테스트 실행 (jest, vitest, pytest)
- 린트/포맷 (eslint, prettier, ruff)
- 빌드 명령 (tsc, webpack, vite)

### 금지되는 명령
- 네트워크 요청 (curl, wget, fetch to external)
- 시스템 관리 (sudo, chmod 777, chown)
- 파일 삭제 (rm -rf, 특히 루트 경로)
- 프로세스 관리 (kill, shutdown)
- 데이터베이스 직접 접근 (psql, mysql CLI)
- 환경 변수 출력 (env, printenv)
- SSH/SCP 명령

### 조건부 허용 (확인 후 실행)
- Docker 명령 (개발 환경 한정)
- 데이터베이스 마이그레이션 (개발 DB 한정)
- 패키지 설치 (신규 의존성 추가 시)`}
  language="markdown"
  filename=".claude/rules/security-guidelines.md"
/>

### 파일 접근 범위 제한

<CodeBlock
  code={`{
  "permissions": {
    "allow": [
      "Read(src/**)",
      "Read(tests/**)",
      "Read(docs/**)",
      "Read(package.json)",
      "Read(tsconfig.json)",
      "Read(.eslintrc*)",
      "Edit(src/**/*.ts)",
      "Edit(src/**/*.tsx)",
      "Edit(tests/**/*.test.ts)",
      "Write(src/**/*.ts)",
      "Write(tests/**/*.test.ts)"
    ],
    "deny": [
      "Read(.env*)",
      "Read(**/secrets/**)",
      "Read(**/*.pem)",
      "Read(**/*.key)",
      "Edit(.git/**)",
      "Edit(node_modules/**)",
      "Edit(dist/**)",
      "Write(.env*)",
      "Write(**/*.pem)",
      "Write(**/*.key)",
      "Write(.git/**)"
    ]
  }
}`}
  language="json"
  filename="파일 접근 범위 제한 설정"
/>

### 보안 체크 자동화 스크립트

<CodeBlock
  code={`#!/bin/bash
# .claude/hooks/security-check.sh
# PreToolUse Hook에서 호출되는 보안 검사 스크립트

TOOL_INPUT="$CLAUDE_TOOL_INPUT"
COMMAND=$(echo "$TOOL_INPUT" | jq -r '.command // empty')
FILE_PATH=$(echo "$TOOL_INPUT" | jq -r '.file_path // empty')

# 1. 위험한 명령 패턴 검사
if [ -n "$COMMAND" ]; then
  DANGEROUS_PATTERNS=(
    "rm -rf /"
    "DROP TABLE"
    "DROP DATABASE"
    "TRUNCATE TABLE"
    "shutdown"
    "sudo rm"
    "chmod 777"
    "> /dev/sda"
    "mkfs"
    ":(){:|:&};:"
  )

  for pattern in "\${DANGEROUS_PATTERNS[@]}"; do
    if echo "$COMMAND" | grep -qi "$pattern"; then
      echo "BLOCKED: 위험한 명령 패턴 감지 - $pattern"
      exit 2
    fi
  done
fi

# 2. 민감 파일 접근 검사
if [ -n "$FILE_PATH" ]; then
  SENSITIVE_PATTERNS=(
    ".env"
    "credentials"
    "secrets"
    ".pem"
    ".key"
    "id_rsa"
    ".p12"
  )

  for pattern in "\${SENSITIVE_PATTERNS[@]}"; do
    if echo "$FILE_PATH" | grep -qi "$pattern"; then
      echo "BLOCKED: 민감 파일 접근 감지 - $FILE_PATH"
      exit 2
    fi
  done
fi

# 3. 하드코딩된 시크릿 패턴 검사
if [ -n "$COMMAND" ] || [ -n "$FILE_PATH" ]; then
  SECRET_PATTERNS=(
    "AKIA[0-9A-Z]{16}"          # AWS Access Key
    "sk-[a-zA-Z0-9]{48}"        # OpenAI API Key
    "ghp_[a-zA-Z0-9]{36}"       # GitHub Token
    "sk-ant-[a-zA-Z0-9-]{90}"   # Anthropic API Key
  )

  CONTENT=$(echo "$TOOL_INPUT" | jq -r '.content // .command // empty')
  for pattern in "\${SECRET_PATTERNS[@]}"; do
    if echo "$CONTENT" | grep -qE "$pattern"; then
      echo "BLOCKED: 하드코딩된 시크릿 패턴 감지"
      exit 2
    fi
  done
fi

exit 0`}
  language="bash"
  filename=".claude/hooks/security-check.sh"
/>

---

## 팀 규모별 가이드라인

팀의 규모와 성숙도에 따라 가이드라인의 깊이와 엄격도가 달라져야 합니다.
너무 엄격하면 생산성이 떨어지고, 너무 느슨하면 사고가 발생합니다.

<ComparisonTable
  title="팀 규모별 가이드라인 비교"
  headers={['항목', '스타트업 (1-10명)', '중소기업 (10-50명)', '대기업 (50명+)']}
  rows={[
    { feature: '가이드라인 문서', values: ['1-2페이지 핵심만', '5-10페이지 상세', '20페이지+ 부서별 분리'] },
    { feature: '권한 설정', values: ['최소한의 deny만', 'allow/deny 균형', '기본 deny, 필요시 allow'] },
    { feature: 'Hook 설정', values: ['PostToolUse 린트만', '린트 + 테스트 + 보안', '전체 파이프라인 + 감사'] },
    { feature: '리뷰 프로세스', values: ['동료 1명 확인', '팀 리드 필수 리뷰', '보안팀 + 아키텍트 리뷰'] },
    { feature: '감사 로그', values: ['Git 히스토리만', '기본 감사 로그', 'SIEM 연동 전체 감사'] },
    { feature: '교육', values: ['README에 가이드', '온보딩 세션', '정기 교육 + 인증'] },
    { feature: '위반 대응', values: ['구두 피드백', '이슈 트래커 등록', '공식 프로세스 + 에스컬레이션'] },
    { feature: '업데이트 주기', values: ['필요시 수시', '월 1회 정기', '분기별 정기 + 사건 후'] },
  ]}
/>

### 스타트업용 최소 가이드라인

<CodeBlock
  code={`# AI 사용 가이드라인 (스타트업 버전)

## 핵심 규칙 3가지
1. 시크릿은 절대 코드에 넣지 않는다 (환경 변수 사용)
2. AI가 만든 코드는 반드시 이해하고 커밋한다
3. 프로덕션 데이터는 AI에게 보여주지 않는다

## 권장 사항
- 테스트 코드 생성에 적극 활용
- 보일러플레이트/CRUD는 AI에게 맡기기
- 복잡한 비즈니스 로직은 직접 작성 후 AI로 리뷰

## settings.json (최소 설정)
deny: rm -rf, curl, wget, sudo
allow: npm test, npm run lint, Read, Glob, Grep`}
  language="markdown"
  filename="스타트업용 guidelines.md"
/>

### 대기업용 상세 가이드라인 구조

<CodeBlock
  code={`.claude/
├── rules/
│   ├── guidelines.md           # 전사 공통 가이드라인
│   ├── security-policy.md      # 보안 정책
│   ├── data-handling.md        # 데이터 취급 정책
│   ├── compliance.md           # 규정 준수 사항
│   ├── frontend/
│   │   ├── react-guidelines.md # React 개발 가이드
│   │   └── testing.md          # 프론트엔드 테스트 규칙
│   ├── backend/
│   │   ├── api-guidelines.md   # API 개발 가이드
│   │   ├── database.md         # DB 접근 규칙
│   │   └── security.md         # 백엔드 보안
│   └── devops/
│       ├── ci-cd.md            # CI/CD 가이드
│       └── infrastructure.md   # 인프라 관련 규칙
├── settings.json               # 팀 공통 설정
├── hooks/
│   ├── security-check.sh       # 보안 검사 스크립트
│   ├── compliance-check.sh     # 규정 준수 검사
│   ├── audit-log.sh            # 감사 로그 기록
│   └── notify-slack.sh         # 알림 발송
└── CLAUDE.md                   # 프로젝트 지침서`}
  language="text"
  filename="대기업용 가이드라인 디렉토리 구조"
/>

---

## 도메인별 가이드라인

업종과 도메인에 따라 추가적인 규정 준수 사항이 있습니다.
AI 에이전트의 사용 범위를 도메인의 특성에 맞게 조정해야 합니다.

<ComparisonTable
  title="도메인별 추가 가이드라인"
  headers={['항목', '금융 (핀테크)', '의료 (헬스케어)', '공공기관']}
  rows={[
    { feature: '관련 법규', values: ['전자금융감독규정, PCI DSS', 'HIPAA, 의료기기법', '개인정보보호법, 전자정부법'] },
    { feature: 'AI 사용 범위', values: ['UI/UX 코드 한정, 금융 로직 수동', '비식별 데이터만, PHI 접근 금지', '보안 등급별 차등 적용'] },
    { feature: '데이터 제한', values: ['카드번호/계좌 AI 입력 금지', '환자 정보 AI 입력 금지', '3등급 이상 데이터 AI 입력 금지'] },
    { feature: '코드 리뷰', values: ['보안 전문가 필수 리뷰', '규정 준수 담당자 리뷰', '보안성 검토 필수'] },
    { feature: '감사 요구', values: ['전체 이력 5년 보관', '전체 이력 6년 보관', '전체 이력 5년 보관'] },
    { feature: '암호화 코드', values: ['검증된 라이브러리만 사용', '검증된 라이브러리만 사용', 'KCMVP 인증 모듈 사용'] },
    { feature: '테스트 요구', values: ['모든 금융 로직 100% 커버리지', 'FDA 검증 수준 테스트', '보안 취약점 테스트 필수'] },
  ]}
/>

### 금융 도메인 가이드라인 예시

<CodeBlock
  code={`# 금융 서비스 AI 사용 가이드라인

## 절대 금지
- 금융 계산 로직을 AI에게 직접 생성 요청 금지
  (이자 계산, 환율 변환, 수수료 산정 등)
- 카드번호, 계좌번호, CVV를 프롬프트에 포함 금지
- 고객 거래 내역을 AI에게 노출 금지
- 암호화/해시 알고리즘을 AI에게 직접 구현 요청 금지

## 허용 (주의 필요)
- UI 컴포넌트 생성 (금액 표시 형식은 수동 검증)
- API 라우팅/미들웨어 코드 생성
- 테스트 케이스 초안 (테스트 데이터는 가상 데이터)
- 에러 핸들링 코드 생성

## 필수 검증
- 모든 금액 관련 코드는 소수점 처리 검증
- 모든 API는 인증/인가 테스트 포함
- PCI DSS 컴플라이언스 체크리스트 적용

## Hook 설정
- PostToolUse: 금융 관련 파일 변경 시 자동 린트
- Stop: 모든 금융 로직 테스트 자동 실행
- PreToolUse: 고객 데이터 패턴 감지 시 차단`}
  language="markdown"
  filename=".claude/rules/finance-guidelines.md"
/>

### 의료 도메인 가이드라인 예시

<CodeBlock
  code={`# 의료 서비스 AI 사용 가이드라인

## HIPAA 준수 사항
- PHI (Protected Health Information) 절대 AI 입력 금지
  - 환자명, 주민등록번호, 의료기록번호
  - 진단명, 처방 내역, 검사 결과
  - 보험 정보, 청구 내역
- 모든 의료 데이터는 비식별화 후 사용

## AI 사용 가능 범위
- 비식별화된 샘플 데이터로 UI 개발
- 의료 기기 인터페이스 코드 (로직 제외)
- 문서화 및 주석 작성 보조
- 테스트 코드 초안 (가상 데이터 사용)

## AI 사용 불가 범위
- 의료 판단 알고리즘
- 처방 검증 로직
- 환자 위험도 계산
- 의료 영상 처리 핵심 로직`}
  language="markdown"
  filename=".claude/rules/healthcare-guidelines.md"
/>

---

## 가이드라인 자동화 (CI/CD 연동)

가이드라인은 문서로만 존재하면 지켜지기 어렵습니다.
CI/CD 파이프라인에 자동 검증을 통합하면 가이드라인 위반을 조기에 발견할 수 있습니다.

### GitHub Actions 연동

<CodeBlock
  code={`# .github/workflows/ai-code-review.yml
name: AI Code Guideline Check

on:
  pull_request:
    types: [opened, synchronize]

jobs:
  guideline-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # 1. 시크릿 패턴 검사
      - name: Detect Hardcoded Secrets
        run: |
          # 변경된 파일에서 시크릿 패턴 검색
          git diff origin/main --name-only | while read file; do
            if [ -f "$file" ]; then
              # AWS 키, API 토큰 등 패턴 검사
              if grep -qE '(AKIA|sk-|ghp_|password\s*=\s*["\x27][^"\x27]+)' "$file"; then
                echo "::error file=$file::하드코딩된 시크릿 패턴 감지"
                exit 1
              fi
            fi
          done

      # 2. 금지된 패턴 검사
      - name: Check Forbidden Patterns
        run: |
          git diff origin/main --name-only | while read file; do
            if [ -f "$file" ]; then
              # eval(), exec() 등 위험한 함수 사용 검사
              if grep -qE '(eval\\(|exec\\(|__import__|os\\.system)' "$file"; then
                echo "::warning file=$file::위험한 함수 사용 감지 - 리뷰 필요"
              fi
            fi
          done

      # 3. AI 생성 코드 표기 확인
      - name: Check AI Attribution
        run: |
          PR_BODY=$(gh pr view \${{ github.event.pull_request.number }} --json body -q '.body')
          if ! echo "$PR_BODY" | grep -qi "ai\|claude\|copilot\|agent"; then
            echo "::notice::AI 사용 여부가 PR 설명에 명시되지 않았습니다"
          fi
        env:
          GH_TOKEN: \${{ secrets.GITHUB_TOKEN }}`}
  language="yaml"
  filename=".github/workflows/ai-code-review.yml"
/>

### Pre-commit Hook 통합

<CodeBlock
  code={`#!/bin/bash
# .git/hooks/pre-commit
# AI 가이드라인 준수 자동 검사

echo "AI 가이드라인 준수 검사 시작..."

# 1. 스테이징된 파일에서 시크릿 검사
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM)
SECRET_FOUND=false

for file in $STAGED_FILES; do
  if [ -f "$file" ]; then
    # API 키, 토큰 패턴 검사
    if grep -nE '(AKIA[0-9A-Z]{16}|sk-[a-zA-Z0-9]{48}|ghp_[a-zA-Z0-9]{36})' "$file"; then
      echo "ERROR: $file 에서 시크릿 패턴 감지"
      SECRET_FOUND=true
    fi

    # .env 파일 커밋 방지
    if echo "$file" | grep -qE '^\\.env'; then
      echo "ERROR: .env 파일은 커밋할 수 없습니다"
      SECRET_FOUND=true
    fi
  fi
done

if [ "$SECRET_FOUND" = true ]; then
  echo "시크릿이 감지되어 커밋이 차단되었습니다."
  exit 1
fi

# 2. 린트 검사
npx eslint --quiet $STAGED_FILES 2>/dev/null
if [ $? -ne 0 ]; then
  echo "린트 검사 실패. 코드를 수정한 후 다시 시도하세요."
  exit 1
fi

echo "AI 가이드라인 검사 통과"
exit 0`}
  language="bash"
  filename=".git/hooks/pre-commit"
/>

### Claude Code Headless Mode + CI/CD 연동

<CodeBlock
  code={`# .github/workflows/claude-review.yml
name: Claude Code Automated Review

on:
  pull_request:
    types: [opened, synchronize]

jobs:
  claude-review:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Claude Security Review
        run: |
          CHANGED_FILES=$(git diff origin/main --name-only | tr '\\n' ', ')
          claude -p "다음 파일들의 보안 취약점을 검토해주세요: $CHANGED_FILES
            검토 항목:
            1. SQL 인젝션 가능성
            2. XSS 취약점
            3. 하드코딩된 시크릿
            4. 인증/인가 누락
            5. 입력 검증 부재" \\
            --output-format json \\
            --allowedTools "Read,Grep,Glob" > review.json

          # 심각한 이슈가 있으면 PR에 코멘트
          if jq -e '.result | test("CRITICAL|HIGH")' review.json; then
            REVIEW=$(jq -r '.result' review.json)
            gh pr comment \${{ github.event.pull_request.number }} \\
              --body "## AI 보안 리뷰 결과\\n\\n$REVIEW"
          fi
        env:
          ANTHROPIC_API_KEY: \${{ secrets.ANTHROPIC_API_KEY }}
          GH_TOKEN: \${{ secrets.GITHUB_TOKEN }}`}
  language="yaml"
  filename="Claude Code Headless Mode CI/CD 연동"
/>

---

## 가이드라인 버전 관리와 변경 이력

가이드라인도 코드처럼 버전 관리가 필요합니다.
변경 사항을 추적하고, 팀이 최신 가이드라인을 인지하도록 관리해야 합니다.

### 가이드라인 변경 프로세스

<MermaidDiagram
  chart={`flowchart LR
    A["변경 필요 식별"] --> B["변경안 작성"]
    B --> C["팀 리뷰"]
    C --> D{"승인?"}
    D -->|Yes| E["가이드라인 업데이트"]
    D -->|No| F["수정 후 재검토"]
    F --> C
    E --> G["팀 공지"]
    G --> H["적용 시작일 지정"]
    H --> I["모니터링"]
    style A fill:#fdf2ee,stroke:#9333ea,color:#2d2a26
    style E fill:#fdf2ee,stroke:#16a34a,color:#2d2a26
    style G fill:#fdf2ee,stroke:#3b82f6,color:#2d2a26`}
  title="가이드라인 변경 프로세스"
  caption="가이드라인 변경도 코드 변경처럼 리뷰와 승인 과정을 거쳐야 합니다."
/>

### 변경 이력 기록 형식

<CodeBlock
  code={`# AI 사용 가이드라인 변경 이력

## [v2.1.0] - 2026-02-07
### 추가
- 의료 도메인 전용 가이드라인 섹션
- UserPromptSubmit Hook을 통한 민감 정보 필터링
### 변경
- 권한 설정에 WebFetch 제한 추가
### 삭제
- (없음)

## [v2.0.0] - 2026-01-15
### 추가
- Hook 기반 자동 검증 파이프라인
- CI/CD 연동 가이드
- 팀 규모별 가이드라인 분리
### 변경
- 권한 모델을 3단계(allow/deny/ask)로 재구성
### 삭제
- 레거시 수동 검증 절차

## [v1.0.0] - 2025-11-01
### 최초 작성
- 기본 허용/금지 사항 정의
- 프롬프트 작성 가이드
- AI 생성 코드 검증 체크리스트`}
  language="markdown"
  filename=".claude/rules/CHANGELOG.md"
/>

<Callout type="tip" title="가이드라인 버전 관리 팁">
  가이드라인은 Semantic Versioning을 적용하면 관리가 편합니다:
  - **Major** (v2.0.0): 근본적인 정책 변경 (예: 기본 deny로 전환)
  - **Minor** (v2.1.0): 새 규칙 추가 또는 기존 규칙 수정
  - **Patch** (v2.1.1): 오타 수정, 예시 추가 등 사소한 변경

  CHANGELOG.md를 `.claude/rules/` 디렉토리에 함께 관리하면 Claude Code가 변경 이력도 참조할 수 있습니다.
</Callout>

---

## 실제 기업 AI 사용 정책 사례

글로벌 기업들의 AI 코드 사용 정책을 참고하면 우리 팀의 가이드라인을 수립하는 데 도움이 됩니다.

<Timeline
  title="주요 기업 AI 정책 타임라인"
  events={[
    {
      date: '2023.06',
      title: 'Samsung - 내부 AI 사용 제한 발표',
      description: 'ChatGPT에 소스코드 유출 사건 이후, 사내 AI 도구 사용 가이드라인을 수립하고 내부 AI 플랫폼 개발을 시작했습니다.',
      highlight: true
    },
    {
      date: '2023.09',
      title: 'Google - 내부 AI 코딩 가이드라인 공개',
      description: 'AI 생성 코드에 대한 코드 리뷰 기준과 책임 소재를 명확히 정의했습니다. 보안 코드는 AI 생성 금지.',
    },
    {
      date: '2024.01',
      title: 'Microsoft - Copilot for Business 보안 프레임워크',
      description: '엔터프라이즈 환경에서 AI Copilot 사용을 위한 보안 프레임워크를 발표했습니다. 데이터 경계, 접근 제어, 감사 로그를 포함.',
      highlight: true
    },
    {
      date: '2024.06',
      title: 'Meta - 내부 AI 코딩 도구 정책',
      description: 'AI 생성 코드의 라이선스 준수 프레임워크를 공개했습니다. 코드 출처 추적과 라이선스 호환성 자동 검사 도입.',
    },
    {
      date: '2025.03',
      title: 'Anthropic - Claude Code 엔터프라이즈 보안 기능',
      description: 'Managed Settings, 감사 로그, 엔터프라이즈 SSO 등 기업용 보안 기능을 Claude Code에 추가했습니다.',
      highlight: true
    },
    {
      date: '2026.01',
      title: '다수 기업 - AI Agent 가이드라인 표준화 움직임',
      description: 'AI Agent의 자율성이 높아지면서, 권한 관리와 감사 로그가 엔터프라이즈 도입의 필수 조건이 되었습니다.',
    }
  ]}
/>

### 공통 패턴: 기업 AI 정책의 핵심 요소

| 요소 | 설명 | 구현 방법 |
|------|------|----------|
| **책임 할당** | AI 코드의 책임자를 명확히 지정 | 커밋 로그, PR 리뷰 정책 |
| **데이터 경계** | AI에 입력할 수 있는 데이터 범위 정의 | 프롬프트 필터링, Hook |
| **접근 제어** | AI 에이전트의 시스템 접근 범위 제한 | settings.json, Managed Settings |
| **감사 추적** | 모든 AI 사용 이력 기록 | 감사 로그, SIEM 연동 |
| **교육** | 정기적인 AI 사용 교육 실시 | 온보딩 프로그램, 워크숍 |
| **사고 대응** | AI 관련 보안 사고 대응 절차 수립 | 인시던트 플레이북 |

---

## 가이드라인 위반 시 대응 프로세스

가이드라인은 위반 시 대응 프로세스가 없으면 유명무실합니다.
위반의 심각도에 따라 대응 수준을 차등 적용해야 합니다.

### 위반 심각도 분류

<ComparisonTable
  title="가이드라인 위반 심각도 분류"
  headers={['심각도', '정의', '예시', '대응']}
  rows={[
    { feature: 'Critical', values: ['데이터 유출 또는 보안 사고 발생', '시크릿 노출, 프로덕션 데이터 유출', '즉시 배포 중단 + 보안팀 보고'] },
    { feature: 'High', values: ['보안 취약점 또는 규정 위반', 'SQL 인젝션 코드 머지, 인증 우회', '즉시 수정 + 팀 리드 보고'] },
    { feature: 'Medium', values: ['품질 또는 아키텍처 위반', '레이어 경계 위반, 테스트 미작성', '다음 스프린트에서 수정'] },
    { feature: 'Low', values: ['스타일 또는 컨벤션 위반', '네이밍 불일치, 포맷팅 위반', '코드 리뷰에서 피드백'] },
  ]}
/>

### 대응 프로세스 흐름

<MermaidDiagram
  chart={`flowchart TB
    A["위반 감지"] --> B{"심각도 판단"}
    B -->|Critical| C["즉시 배포 중단"]
    B -->|High| D["즉시 수정 패치"]
    B -->|Medium| E["이슈 등록"]
    B -->|Low| F["코드 리뷰 피드백"]
    C --> G["보안팀 보고"]
    G --> H["근본 원인 분석"]
    D --> H
    H --> I["재발 방지 대책"]
    I --> J["가이드라인 업데이트"]
    E --> K["다음 스프린트 수정"]
    K --> J
    F --> L["팀 공유"]
    J --> M["팀 공지 및 교육"]
    style C fill:#fdf2ee,stroke:#dc2626,color:#2d2a26
    style D fill:#fdf2ee,stroke:#d97706,color:#2d2a26
    style E fill:#fdf2ee,stroke:#3b82f6,color:#2d2a26
    style F fill:#fdf2ee,stroke:#16a34a,color:#2d2a26`}
  title="가이드라인 위반 대응 흐름"
  caption="심각도에 따라 대응 수준과 에스컬레이션 경로가 달라집니다."
/>

---

## 감사(Audit) 로그와 모니터링

엔터프라이즈 환경에서는 AI 에이전트의 모든 활동을 추적하고 감사할 수 있어야 합니다.

### 감사 로그 설정

<CodeBlock
  code={`{
  "audit": {
    "enabled": true,
    "retention_days": 90,
    "log_level": "detailed",
    "export_format": ["json", "csv"],
    "siem_integration": {
      "enabled": true,
      "provider": "Splunk",
      "endpoint": "https://splunk.company.internal/api",
      "events": [
        "tool_execution",
        "file_modification",
        "permission_denied",
        "hook_triggered",
        "session_start_end"
      ]
    }
  }
}`}
  language="json"
  filename="Enterprise 감사 로그 설정"
/>

### Hook 기반 감사 로그 수집

<CodeBlock
  code={`#!/bin/bash
# .claude/hooks/audit-log.sh
# 모든 도구 실행을 감사 로그에 기록

TIMESTAMP=$(date -u +"%Y-%m-%dT%H:%M:%SZ")
SESSION_ID="$CLAUDE_SESSION_ID"
TOOL_NAME="$CLAUDE_TOOL_NAME"
EVENT="$CLAUDE_HOOK_EVENT_NAME"

# 로그 디렉토리 확인
LOG_DIR=".claude/audit-logs"
mkdir -p "$LOG_DIR"

# JSON 형식으로 로그 기록
LOG_ENTRY=$(jq -n \\
  --arg ts "$TIMESTAMP" \\
  --arg sid "$SESSION_ID" \\
  --arg tool "$TOOL_NAME" \\
  --arg event "$EVENT" \\
  --arg cwd "$(pwd)" \\
  '{
    timestamp: $ts,
    session_id: $sid,
    tool: $tool,
    event: $event,
    working_directory: $cwd
  }')

echo "$LOG_ENTRY" >> "$LOG_DIR/audit-$(date +%Y-%m-%d).jsonl"

exit 0`}
  language="bash"
  filename=".claude/hooks/audit-log.sh"
/>

### 모니터링 대시보드 연동

<CodeBlock
  code={`{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "",
        "hooks": [
          {
            "type": "command",
            "command": ".claude/hooks/audit-log.sh",
            "async": true
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "matcher": "",
        "hooks": [
          {
            "type": "command",
            "command": ".claude/hooks/audit-log.sh",
            "async": true
          }
        ]
      }
    ],
    "Notification": [
      {
        "matcher": "",
        "hooks": [
          {
            "type": "command",
            "command": ".claude/hooks/notify-slack.sh",
            "async": true
          }
        ]
      }
    ]
  }
}`}
  language="json"
  filename="전체 활동 감사 로그 수집 설정"
/>

<Callout type="info" title="감사 로그 보관 기간">
  감사 로그의 보관 기간은 산업 규정에 따라 다릅니다:
  - **금융**: 최소 5년 (전자금융감독규정)
  - **의료**: 최소 6년 (의료법 시행규칙)
  - **공공기관**: 최소 5년 (공공기록물 관리법)
  - **일반 기업**: 권장 1-3년

  `.claude/audit-logs/` 디렉토리는 반드시 `.gitignore`에 추가하고, 별도의 로그 스토리지로 전송하세요.
</Callout>

---

## 가이드라인 템플릿 (바로 사용 가능)

아래는 팀에서 바로 복사해서 사용할 수 있는 가이드라인 템플릿입니다.
팀의 상황에 맞게 수정하여 사용하세요.

### 기본 가이드라인 템플릿

<CodeBlock
  code={`# AI Agent 사용 가이드라인
# 프로젝트: [프로젝트명]
# 버전: v1.0.0
# 최종 수정: [날짜]
# 관리자: [담당자]

## 1. 핵심 원칙
- AI 생성 코드의 최종 책임은 커밋한 개발자에게 있다
- 이해하지 못한 코드는 커밋하지 않는다
- 프로덕션 데이터는 AI에게 노출하지 않는다
- 시크릿은 절대 코드에 하드코딩하지 않는다

## 2. 허용되는 사용 사례
- [x] 보일러플레이트 코드 생성
- [x] 테스트 케이스 초안 작성
- [x] 코드 리뷰 보조
- [x] 문서화 보조
- [x] 리팩토링 제안
- [x] 디버깅 지원
- [x] 프로토타이핑

## 3. 금지되는 사용 사례
- [ ] 보안 관련 코드 무검증 적용
- [ ] 프로덕션 데이터 프롬프트 포함
- [ ] 시크릿/API 키 노출
- [ ] 라이선스 불명 코드 복사
- [ ] 개인정보(PII) 포함 프롬프트
- [ ] 암호화 알고리즘 직접 구현 요청

## 4. 코드 검증 체크리스트
- [ ] 코드 동작을 이해했는가?
- [ ] 단위 테스트가 작성되었는가?
- [ ] 보안 취약점이 없는가?
- [ ] 코딩 컨벤션을 따르는가?
- [ ] 에러 처리가 적절한가?

## 5. PR 작성 시 AI 사용 표기
AI 도움을 받은 경우 PR에 다음을 명시:
- AI 사용 여부
- AI 사용 범위 (어떤 파일/기능)
- 특별히 주의할 부분`}
  language="markdown"
  filename=".claude/rules/guidelines.md (템플릿)"
/>

### 권한 설정 템플릿

<CodeBlock
  code={`{
  "permissions": {
    "allow": [
      "Read",
      "Glob",
      "Grep",
      "Bash(npm test*)",
      "Bash(npm run lint*)",
      "Bash(npm run build*)",
      "Bash(npx jest*)",
      "Bash(npx eslint*)",
      "Bash(npx prettier*)",
      "Bash(git status)",
      "Bash(git diff*)",
      "Bash(git log*)",
      "Edit(src/**)",
      "Edit(tests/**)",
      "Write(src/**)",
      "Write(tests/**)"
    ],
    "deny": [
      "Bash(curl*)",
      "Bash(wget*)",
      "Bash(rm -rf*)",
      "Bash(sudo*)",
      "Bash(ssh*)",
      "Bash(scp*)",
      "Bash(*production*)",
      "Bash(*deploy*)",
      "Bash(env)",
      "Bash(printenv)",
      "Write(.env*)",
      "Write(*.pem)",
      "Write(*.key)",
      "Write(*.secret)",
      "Edit(.git/**)",
      "Edit(node_modules/**)"
    ]
  },
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "npx eslint --fix $CLAUDE_FILE_PATH 2>/dev/null || true"
          }
        ]
      }
    ],
    "Stop": [
      {
        "matcher": "",
        "hooks": [
          {
            "type": "command",
            "command": "npm test -- --bail 2>/dev/null || true"
          }
        ]
      }
    ]
  }
}`}
  language="json"
  filename=".claude/settings.json (템플릿)"
/>

---

## 프롬프트 작성 가이드

### 좋은 프롬프트 vs 나쁜 프롬프트

<CodeBlock
  code={`## 좋은 프롬프트 예시

다음 조건을 만족하는 사용자 인증 서비스를 구현해주세요:

### 요구사항
- JWT 기반 인증
- 리프레시 토큰 지원
- bcrypt로 비밀번호 해싱 (cost factor: 12)

### 기술 스택
- TypeScript, Express.js, PostgreSQL

### 제약사항
- 기존 User 엔터티 사용
- 에러 처리는 AppError 클래스 사용
- 테스트 코드 포함

### 참고
- 기존 코드: src/services/base-service.ts
- 컨벤션: .claude/rules/conventions.md 참조`}
  language="markdown"
  filename="좋은 프롬프트"
/>

<CodeBlock
  code={`## 나쁜 프롬프트 예시

- "로그인 기능 만들어줘"
   → 너무 모호함, 요구사항 불명확

- "이 에러 고쳐줘: [프로덕션 로그 전체 복사]"
   → 민감한 데이터 포함 가능

- "AWS_SECRET_KEY=xxx 이거 사용해서 S3 연동해줘"
   → 시크릿 노출`}
  language="markdown"
  filename="나쁜 프롬프트"
/>

<Callout type="info" title="프롬프트에 컨텍스트를 제공하세요">
  Claude Code는 CLAUDE.md와 .claude/rules/를 자동으로 읽지만, 특정 작업에 필요한 추가 컨텍스트는 프롬프트에서 직접 알려주는 것이 효과적입니다.
  "src/services/auth.ts 파일을 참고해서"처럼 구체적인 파일 경로를 제시하면 Claude Code가 해당 파일을 읽고 기존 패턴을 따릅니다.
</Callout>

### 프롬프트 보안 체크리스트

프롬프트를 입력하기 전에 다음을 확인하세요:

| 확인 항목 | 설명 |
|-----------|------|
| 시크릿 미포함 | API 키, 비밀번호, 토큰이 포함되지 않았는가? |
| PII 미포함 | 실제 이름, 이메일, 전화번호가 포함되지 않았는가? |
| 프로덕션 데이터 미포함 | 실제 운영 환경의 데이터가 포함되지 않았는가? |
| 내부 URL 미포함 | 사내 시스템 주소가 포함되지 않았는가? |
| 비즈니스 기밀 미포함 | 미공개 사업 정보가 포함되지 않았는가? |

---

## AI 생성 코드 검증 체크리스트

| 카테고리 | 확인 항목 |
|----------|----------|
| **기능** | 요구사항 정확 구현, 엣지 케이스 처리, 에러 핸들링 |
| **보안** | 입력 검증, SQL/XSS 인젝션 방지, 인증/인가, 민감 정보 미포함 |
| **품질** | 코딩 컨벤션 준수, 중복 코드 없음, 테스트 작성 |
| **이해도** | 코드 동작 이해, 구현 이유 설명 가능, 디버깅 가능 |
| **아키텍처** | 레이어 경계 준수, 의존성 방향 확인, 네이밍 규칙 준수 |
| **성능** | 불필요한 연산 없음, N+1 쿼리 없음, 메모리 누수 위험 없음 |

---

## 팀 협업과 지식 공유

### PR 작성 시 AI 사용 표기

AI 도움을 받은 코드는 PR에 명시하는 것을 권장합니다:

<CodeBlock
  code={`## PR 설명

### 변경 사항
- 사용자 인증 서비스 구현
- JWT 리프레시 토큰 지원 추가

### AI 지원 여부
- [x] 이 PR은 AI 에이전트의 도움을 받아 작성되었습니다

### AI 사용 내역
| 파일 | AI 사용 범위 | 검증 상태 |
|------|-------------|----------|
| auth.service.ts | 보일러플레이트 생성 | 수동 검토 완료 |
| auth.service.test.ts | 테스트 초안 | 케이스 추가 후 완료 |
| auth.controller.ts | 라우팅 코드 생성 | 검증 완료 |

### 특별 주의 사항
- JWT 시크릿 키는 환경 변수로 분리되어 있음
- 리프레시 토큰 만료 로직은 수동으로 작성함`}
  language="markdown"
  filename="PR 템플릿 - AI 사용 표기"
/>

### 팀 가이드라인 온보딩

<CodeBlock
  code={`# 신규 팀원 AI 가이드라인 온보딩 체크리스트

## Day 1: 기본 설정
- [ ] Claude Code 설치 및 인증
- [ ] .claude/settings.json 확인 (팀 공통 설정)
- [ ] .claude/settings.local.json 개인 설정 생성
- [ ] .claude/rules/ 디렉토리 전체 읽기

## Day 2: 실습
- [ ] 간단한 보일러플레이트 생성 실습
- [ ] 테스트 코드 생성 및 검증 실습
- [ ] Hook이 정상 동작하는지 확인
- [ ] 의도적으로 금지 명령 실행하여 차단 확인

## Week 1: 실전 적용
- [ ] 실제 태스크에 AI 활용 (동료 페어)
- [ ] PR에 AI 사용 표기 실습
- [ ] 코드 리뷰에서 AI 생성 코드 검증 실습

## Week 2: 자립
- [ ] 독립적으로 AI 활용 개발
- [ ] 가이드라인 개선 제안 (있다면)
- [ ] 팀에 유용한 프롬프트 공유`}
  language="markdown"
  filename="AI 가이드라인 온보딩 체크리스트"
/>

---

## 핵심 정리

<Callout type="tip" title="가이드라인 = 규칙 + 도구 설정의 조합">
  효과적인 가이드라인 체계는 세 가지 계층으로 구성됩니다:
  1. **문서화된 규칙** -- `.claude/rules/guidelines.md`에 원칙과 허용/금지 사항 명시
  2. **권한 설정** -- `.claude/settings.json`의 `permissions`로 도구 수준 제어
  3. **자동 검증** -- Hooks로 린트, 테스트, 보안 스캔을 자동 실행

  이 세 계층이 함께 작동하면, AI가 생성하는 코드의 품질과 안전성을 체계적으로 보장할 수 있습니다.
</Callout>

| 주제 | 핵심 포인트 |
|------|------------|
| **3계층 구조** | 문서 규칙 + 권한 설정 + 자동 검증으로 가이드라인 강제 |
| **권한 모델** | Enterprise > Project > User 계층, deny 우선 |
| **Hooks** | PreToolUse로 차단, PostToolUse로 품질 검증, Stop으로 테스트 |
| **보안** | 시크릿 차단, 민감 파일 접근 제한, 프롬프트 필터링 |
| **팀 규모** | 스타트업은 최소 규칙, 대기업은 부서별 상세 규칙 |
| **도메인** | 금융/의료/공공 등 업종별 추가 규정 준수 |
| **자동화** | CI/CD 연동으로 가이드라인 위반 자동 감지 |
| **감사** | 전체 활동 로그 수집, SIEM 연동, 규정별 보관 기간 준수 |
| **변경 관리** | 가이드라인도 SemVer + CHANGELOG로 버전 관리 |
| **위반 대응** | 심각도별 차등 대응, 근본 원인 분석, 재발 방지 |


<ChapterNav
  prev={{ title: '아키텍처', path: '/docs/part-2--프로젝트-템플릿-구조-아키텍처' }}
  next={{ title: '문서 템플릿', path: '/docs/part-2--프로젝트-템플릿-구조-문서-템플릿' }}
/>

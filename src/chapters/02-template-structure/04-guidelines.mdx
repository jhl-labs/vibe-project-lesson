import { Meta } from '@storybook/blocks';
import { Callout } from '../../components/Callout';
import { CodeBlock } from '../../components/CodeBlock';
import { TemplateFileViewer } from '../../components/TemplateFileViewer';
import { ComparisonTable } from '../../components/ComparisonTable';
import { Quiz } from '../../components/Quiz';
import { ChapterNav } from '../../components/ChapterNav';
import { templateFiles } from '../../data/template-files';

<Meta title="Part 2: 프로젝트 템플릿 구조/가이드라인" />

# 가이드라인

> AI 에이전트 사용의 원칙과 규칙

## 핵심 원칙

### 책임 소재

<Callout type="important" title="가장 중요한 원칙">
  AI 생성 코드의 최종 책임은 커밋한 개발자에게 있습니다.
  "AI가 만들어준 코드"는 면책 사유가 되지 않습니다.
</Callout>

### 검증 절차

<CodeBlock
  code={`AI 코드 생성 → 개발자 검토 → 단위 테스트 → 보안 스캔 → 코드 리뷰 → 머지`}
  language="text"
  filename="AI 코드 검증 파이프라인"
/>

## 허용 vs 금지 사항

<ComparisonTable
  title="AI 사용 가이드"
  headers={['사용 사례', '허용 여부', '주의사항']}
  rows={[
    { feature: '보일러플레이트 생성', values: ['yes', '구조 확인'] },
    { feature: '테스트 케이스 초안', values: ['yes', '커버리지 검토'] },
    { feature: '문서화 보조', values: ['yes', '내용 검증'] },
    { feature: '코드 리뷰 1차 검토', values: ['yes', '보안 중점'] },
    { feature: '리팩토링 제안', values: ['yes', '영향도 분석'] },
    { feature: '보안 코드 무검증 적용', values: ['no', '보안팀 검토 필수'] },
    { feature: '프로덕션 데이터 프롬프트', values: ['no', '익명화 데이터 사용'] },
    { feature: '시크릿 노출', values: ['no', '환경 변수만'] },
    { feature: '라이선스 불명 코드 복사', values: ['no', '라이선스 확인'] },
    { feature: '개인정보 포함 프롬프트', values: ['no', 'PII 제거'] },
  ]}
/>

## 프롬프트 작성 가이드

### 좋은 프롬프트 vs 나쁜 프롬프트

<CodeBlock
  code={`## 좋은 프롬프트 예시

다음 조건을 만족하는 사용자 인증 서비스를 구현해주세요:

### 요구사항
- JWT 기반 인증
- 리프레시 토큰 지원
- bcrypt로 비밀번호 해싱 (cost factor: 12)

### 기술 스택
- TypeScript, Express.js, PostgreSQL

### 제약사항
- 기존 User 엔터티 사용
- 에러 처리는 AppError 클래스 사용
- 테스트 코드 포함

### 참고
- 기존 코드: src/services/base-service.ts
- 컨벤션: .agent/conventions.md 참조`}
  language="markdown"
  filename="좋은 프롬프트"
/>

<CodeBlock
  code={`## 나쁜 프롬프트 예시

❌ "로그인 기능 만들어줘"
   → 너무 모호함, 요구사항 불명확

❌ "이 에러 고쳐줘: [프로덕션 로그 전체 복사]"
   → 민감한 데이터 포함 가능

❌ "AWS_SECRET_KEY=xxx 이거 사용해서 S3 연동해줘"
   → 시크릿 노출`}
  language="markdown"
  filename="나쁜 프롬프트"
/>

## AI 생성 코드 검증 체크리스트

| 카테고리 | 확인 항목 |
|----------|----------|
| **기능** | 요구사항 정확 구현, 엣지 케이스 처리, 에러 핸들링 |
| **보안** | 입력 검증, SQL/XSS 인젝션 방지, 인증/인가, 민감 정보 |
| **품질** | 코딩 컨벤션 준수, 중복 코드 없음, 테스트 작성 |
| **이해도** | 코드 동작 이해, 구현 이유 설명 가능 |

## 실제 guidelines.md 파일

<TemplateFileViewer
  filename=".agent/guidelines.md"
  content={templateFiles['.agent/guidelines.md']}
  language="markdown"
  annotations={[
    { lineStart: 1, lineEnd: 8, text: '가이드라인 문서의 개요입니다. Claude, Cursor, Roo Code 등 다양한 AI 도구 활용 시 적용됩니다.' },
    { lineStart: 9, lineEnd: 30, text: '핵심 원칙: 책임 소재와 검증 필수 원칙입니다. AI 생성 코드의 책임은 커밋한 개발자에게 있으며, 모든 코드는 검증 파이프라인을 거쳐야 합니다.' },
    { lineStart: 32, lineEnd: 74, text: '허용/금지 사항을 테이블로 정리합니다. 권장, 주의 필요, 절대 금지로 구분하여 명확한 기준을 제시합니다.' },
    { lineStart: 76, lineEnd: 141, text: '프롬프트 작성 가이드입니다. 좋은/나쁜 프롬프트 예시와 컨텍스트 제공 방법을 구체적으로 보여줍니다.' },
    { lineStart: 142, lineEnd: 179, text: '코드 검증 체크리스트와 자동 검증 설정입니다. CI에서 자동으로 린트, 타입 체크, 테스트, 보안 스캔을 수행합니다.' },
    { lineStart: 181, lineEnd: 250, text: '팀 협업 규칙입니다. PR에 AI 사용 여부를 표기하고, 모니터링/감사를 통해 품질을 유지합니다.' },
  ]}
/>

<Quiz
  title="가이드라인 이해도 확인"
  questions={[
    {
      question: 'AI 생성 코드의 최종 책임은 누구에게 있나요?',
      options: ['AI 도구 제공 업체', '코드를 커밋한 개발자', '팀 리더', 'AI 도구 자체'],
      correctIndex: 1,
      explanation: 'AI가 생성한 코드라도 개발자가 검토하고 커밋하면 해당 개발자의 책임입니다. "AI가 만들어준 코드"는 면책 사유가 되지 않습니다.',
    },
    {
      question: '다음 중 AI 프롬프트에 포함해서는 안 되는 것은?',
      options: ['기술 스택 정보', '코딩 컨벤션 참조', '프로덕션 데이터', '기존 코드 파일 경로'],
      correctIndex: 2,
      explanation: '프로덕션 데이터는 데이터 유출 위험이 있으므로 프롬프트에 포함해서는 안 됩니다. 대신 익명화/가상 데이터를 사용해야 합니다.',
    },
  ]}
/>

<ChapterNav
  prev={{ title: '아키텍처', path: '/docs/part-2--프로젝트-템플릿-구조-아키텍처' }}
  next={{ title: '슬래시 커맨드', path: '/docs/part-3--ai-agent-워크플로우-슬래시-커맨드' }}
/>

import { Meta } from '@storybook/addon-docs/blocks';
import { Callout } from '../../components/Callout';
import { CodeBlock } from '../../components/CodeBlock';
import { TemplateFileViewer } from '../../components/TemplateFileViewer';
import { ComparisonTable } from '../../components/ComparisonTable';
import { MermaidDiagram } from '../../components/MermaidDiagram';
import { ChapterNav } from '../../components/ChapterNav';
import { templateFiles } from '../../data/template-files';

<Meta title="Part 4: MCP와 통합/MCP 개요" />

# MCP (Model Context Protocol) 개요

> AI 에이전트의 기능을 확장하는 표준 프로토콜

## MCP란?

**MCP(Model Context Protocol)**는 Anthropic이 **2024년 11월 25일** 공개한 **개방형 표준 프로토콜**로, AI 에이전트가 외부 도구 및 서비스와 **JSON-RPC 2.0** 기반으로 양방향 통신합니다. 처음부터 MIT 라이선스 하에 오픈소스로 공개되었으며, 2025년 12월 9일 Anthropic은 MCP를 Linux Foundation 산하 **Agentic AI Foundation (AAIF)**에 기부하여 오픈 거버넌스로 전환했습니다. 현재 스펙 버전은 **2025-11-25**이며, Claude Code, VS Code, Cursor, GitHub Copilot, JetBrains IDE 등 주요 AI 코딩 도구가 MCP를 지원합니다.

<Callout type="info" title="비유">
  MCP는 AI 에이전트의 "USB 포트"와 같습니다.
  다양한 도구(MCP 서버)를 꽂아서 AI의 능력을 확장할 수 있습니다.
</Callout>

## 핵심 기능 (Primitives)

MCP는 단순히 "도구 호출"만 지원하는 것이 아닙니다. 세 가지 핵심 기능을 제공합니다:

<ComparisonTable
  title="MCP 핵심 기능"
  headers={['기능', '방향', '설명', '예시']}
  rows={[
    { feature: 'Resources', values: ['서버 → 클라이언트', 'AI 컨텍스트에 데이터를 주입', '파일 내용, DB 스키마, 설정 문서'] },
    { feature: 'Tools', values: ['클라이언트 → 서버', 'AI가 외부 시스템에서 액션을 실행', 'Git 커밋, API 호출, 쿼리 실행'] },
    { feature: 'Prompts', values: ['서버 → 클라이언트', '재사용 가능한 프롬프트 템플릿 제공', '코드 리뷰 프롬프트, SQL 생성 프롬프트'] },
  ]}
/>

## 구조

<MermaidDiagram
  chart={`flowchart LR
    CC["🤖 Claude Code<br/>(MCP Client)"]
    FS["📁 Filesystem<br/>Server"]
    GIT["🔀 Git<br/>Server"]
    GH["🐙 GitHub<br/>Server"]
    DB["💾 Database<br/>Server"]
    FE["🌐 Fetch<br/>Server"]
    CC <-->|MCP Protocol| FS
    CC <-->|MCP Protocol| GIT
    CC <-->|MCP Protocol| GH
    CC <-->|MCP Protocol| DB
    CC <-->|MCP Protocol| FE
    style CC fill:#da7756,stroke:#c4613e,color:#fff
    style FS fill:#fdf2ee,stroke:#16a34a,color:#2d2a26
    style GIT fill:#fdf2ee,stroke:#16a34a,color:#2d2a26
    style GH fill:#fdf2ee,stroke:#d97706,color:#2d2a26
    style DB fill:#fdf2ee,stroke:#dc2626,color:#2d2a26
    style FE fill:#fdf2ee,stroke:#2563eb,color:#2d2a26`}
  title="MCP 아키텍처"
  caption="Claude Code가 MCP 프로토콜을 통해 다양한 외부 도구 서버와 양방향 통신합니다"
/>

<MermaidDiagram
  chart={`sequenceDiagram
    participant U as 👤 사용자
    participant CC as 🤖 Claude Code
    participant MCP as MCP Server
    participant EXT as 🔧 외부 시스템
    U->>CC: 작업 요청
    CC->>CC: 컨텍스트 분석
    CC->>MCP: Tool 호출 (JSON-RPC)
    MCP->>EXT: API 호출 / 명령 실행
    EXT-->>MCP: 결과 반환
    MCP-->>CC: Tool 결과 (JSON-RPC)
    CC->>CC: 결과 기반 추론
    CC-->>U: 응답 (코드/설명)`}
  title="MCP 통신 흐름"
  caption="사용자 요청 → Claude Code 분석 → MCP 서버 호출 → 외부 시스템 작업 → 결과 반환"
/>

## .mcp.json 설정

MCP 서버 설정은 프로젝트 루트의 `.mcp.json` 파일에서 관리합니다.

<TemplateFileViewer
  filename=".mcp.json.example"
  content={templateFiles['.mcp.json.example']}
  language="json"
  annotations={[
    { lineStart: 1, lineEnd: 2, text: '설정 파일은 .mcp.json.example로 제공됩니다. 실제 사용 시 .mcp.json으로 복사하고 프로젝트에 맞게 수정합니다.' },
    { lineStart: 3, lineEnd: 9, text: 'Filesystem MCP 서버입니다. 프로젝트 디렉토리 내 파일을 읽고 쓸 수 있게 합니다.' },
    { lineStart: 10, lineEnd: 14, text: 'Git MCP 서버입니다. 커밋, 브랜치, 히스토리 등 Git 작업을 수행합니다.' },
    { lineStart: 15, lineEnd: 23, text: 'GitHub MCP 서버입니다. PR, 이슈, 리뷰 등 GitHub API를 사용합니다. GITHUB_TOKEN 환경 변수가 필요합니다.' },
    { lineStart: 24, lineEnd: 32, text: 'PostgreSQL MCP 서버입니다. 데이터베이스 쿼리를 직접 실행할 수 있습니다. disabled: true로 기본 비활성화되어 있습니다.' },
    { lineStart: 40, lineEnd: 45, text: 'Fetch MCP 서버입니다. 외부 API 호출이나 웹 콘텐츠를 가져올 수 있습니다.' },
  ]}
/>

## 권장 MCP 서버

| 서버 | 용도 | 필수 환경 변수 |
|------|------|---------------|
| **filesystem** | 파일 읽기/쓰기 | 없음 |
| **git** | Git 작업 | 없음 |
| **github** | GitHub API (PR, 이슈) | `GITHUB_TOKEN` |
| **postgres** | PostgreSQL 쿼리 | `DATABASE_URL` |
| **sqlite** | SQLite 쿼리 | 없음 (DB 경로 지정) |
| **fetch** | HTTP 요청 | 없음 |
| **puppeteer** | 브라우저 자동화 | 없음 |
| **slack** | Slack 연동 | `SLACK_BOT_TOKEN` |

## 보안 고려사항

<Callout type="warning" title="MCP 보안 주의사항">
  MCP 서버는 외부 시스템에 접근 권한을 부여하므로 보안에 주의해야 합니다.
</Callout>

### 주의사항

1. **환경 변수로 시크릿 관리**: 토큰/키를 .mcp.json에 직접 작성하지 마세요
2. **최소 권한 원칙**: 필요한 서버만 활성화하세요 (`disabled: true` 활용)
3. **.mcp.json은 .gitignore에 추가**: 실제 설정 파일은 Git에 커밋하지 마세요
4. **DB 접근 제한**: 프로덕션 DB에 직접 연결하지 마세요
5. **읽기 전용 우선**: 가능하면 읽기 전용 권한만 부여하세요

<CodeBlock
  code={`# .gitignore에 추가
.mcp.json

# .mcp.json.example은 커밋 (템플릿으로 제공)
!.mcp.json.example`}
  language="bash"
  filename=".gitignore 설정"
/>

## MCP 설정 방법

<CodeBlock
  code={`# 1. 템플릿 복사
cp .mcp.json.example .mcp.json

# 2. 필요한 서버 활성화 (disabled: false로 변경)
# 3. 환경 변수 설정
export GITHUB_TOKEN="ghp_your_token_here"

# 4. Claude Code 실행
claude`}
  language="bash"
  filename="MCP 설정 순서"
/>

<Callout type="info" title="MCP 설정 범위">
  Claude Code에서 MCP 서버는 **프로젝트 레벨**(`.mcp.json`)과 **사용자 레벨**(`~/.claude.json`)로 구분하여 관리할 수 있습니다.
  엔터프라이즈에서는 Managed Settings의 `allowedMcpServers`/`deniedMcpServers`로 허용 서버를 제한할 수 있습니다.
</Callout>

<ChapterNav
  prev={{ title: 'Hooks', path: '/docs/part-3--ai-agent-워크플로우-hooks' }}
  next={{ title: 'GitHub Actions', path: '/docs/part-4--mcp와-통합-github-actions' }}
/>

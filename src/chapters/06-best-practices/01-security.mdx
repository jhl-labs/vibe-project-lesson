import { Meta } from '@storybook/blocks';
import { Callout } from '../../components/Callout';
import { CodeBlock } from '../../components/CodeBlock';
import { ComparisonTable } from '../../components/ComparisonTable';
import { Quiz } from '../../components/Quiz';
import { ChapterNav } from '../../components/ChapterNav';

<Meta title="Part 6: 모범 사례/보안" />

# 보안

> AI 코딩 시대의 보안 위협과 대응

## AI 코딩의 보안 위험

AI가 생성한 코드에는 다음과 같은 보안 위험이 존재합니다:

<Callout type="warning" title="주요 위험">
  AI는 "동작하는 코드"를 생성하지만, "안전한 코드"를 보장하지는 않습니다.
  생성된 코드의 보안 검증은 개발자의 책임입니다.
</Callout>

### 흔한 보안 취약점

| 취약점 | AI가 생성할 수 있는 위험 코드 | 올바른 코드 |
|--------|---------------------------|------------|
| SQL Injection | 문자열 연결로 쿼리 작성 | 파라미터화된 쿼리 사용 |
| XSS | innerHTML 직접 사용 | 이스케이프 처리 |
| 하드코딩 시크릿 | API 키를 코드에 포함 | 환경 변수 사용 |
| 불안전한 의존성 | 오래된/취약한 라이브러리 사용 | 최신 안정 버전 사용 |

## OWASP Top 10 체크리스트

<ComparisonTable
  title="OWASP Top 10 (2021) 점검"
  headers={['순위', '취약점', 'AI 코드 위험도', '대응 방법']}
  rows={[
    { feature: 'A01', values: ['접근 제어 취약점', '높음', '모든 엔드포인트 인가 확인'] },
    { feature: 'A02', values: ['암호화 실패', '중간', '검증된 암호화 라이브러리 사용'] },
    { feature: 'A03', values: ['인젝션', '높음', '파라미터화 쿼리, ORM 사용'] },
    { feature: 'A04', values: ['불안전한 설계', '중간', '위협 모델링 수행'] },
    { feature: 'A05', values: ['보안 설정 오류', '높음', '기본 설정 변경, 최소 권한'] },
    { feature: 'A06', values: ['취약한 컴포넌트', '높음', '의존성 스캔 자동화'] },
    { feature: 'A07', values: ['인증 실패', '중간', '검증된 인증 라이브러리 사용'] },
    { feature: 'A08', values: ['무결성 실패', '낮음', 'lock 파일 커밋, 서명 검증'] },
    { feature: 'A09', values: ['로깅/모니터링 실패', '중간', '구조화된 로깅 구현'] },
    { feature: 'A10', values: ['SSRF', '중간', 'URL 화이트리스트 적용'] },
  ]}
/>

## 안전한 코드 패턴

### SQL Injection 방지

<CodeBlock
  code={`// ❌ 위험: 문자열 연결
const query = \`SELECT * FROM users WHERE id = '\${userId}'\`;

// ✅ 안전: 파라미터화된 쿼리
const query = 'SELECT * FROM users WHERE id = $1';
const result = await db.query(query, [userId]);

// ✅ 안전: ORM 사용
const user = await prisma.user.findUnique({ where: { id: userId } });`}
  language="typescript"
  filename="SQL Injection 방지"
/>

### XSS 방지

<CodeBlock
  code={`// ❌ 위험: innerHTML 직접 사용
element.innerHTML = userInput;

// ✅ 안전: textContent 사용
element.textContent = userInput;

// ✅ 안전: React는 기본적으로 이스케이프
return <div>{userInput}</div>;

// ❌ 위험: dangerouslySetInnerHTML
return <div dangerouslySetInnerHTML={{ __html: userInput }} />;`}
  language="typescript"
  filename="XSS 방지"
/>

### 환경 변수 관리

<CodeBlock
  code={`// ❌ 위험: 하드코딩
const API_KEY = 'sk-1234567890abcdef';

// ✅ 안전: 환경 변수
const API_KEY = process.env.API_KEY;
if (!API_KEY) {
  throw new Error('API_KEY is required');
}`}
  language="typescript"
  filename="환경 변수 관리"
/>

## Security Scan 워크플로우

<CodeBlock
  code={`# 보안 검사 자동화 파이프라인

1. 코드 작성 (AI 생성 포함)
     │
     ▼
2. 정적 분석 (SAST)
   - ESLint security rules
   - SonarQube
     │
     ▼
3. 의존성 검사
   - npm audit
   - Dependabot alerts
     │
     ▼
4. /security 커맨드
   - OWASP Top 10 체크
   - 커스텀 보안 규칙
     │
     ▼
5. 보안 코드 리뷰
   - Security 서브에이전트
   - 인간 보안 리뷰어
     │
     ▼
6. 배포`}
  language="text"
  filename="보안 검사 파이프라인"
/>

<Quiz
  title="보안 이해도 확인"
  questions={[
    {
      question: 'AI가 생성한 코드에서 가장 흔한 보안 취약점은?',
      options: ['메모리 누수', 'SQL Injection과 하드코딩된 시크릿', '성능 저하', '타입 오류'],
      correctIndex: 1,
      explanation: 'AI는 동작하는 코드를 우선 생성하므로, 문자열 연결 쿼리나 하드코딩된 API 키 등의 보안 취약점이 포함될 수 있습니다.',
    },
    {
      question: '다음 중 안전한 코드 패턴은?',
      options: ['문자열 연결로 SQL 쿼리 작성', 'innerHTML로 사용자 입력 렌더링', '파라미터화된 쿼리 사용', 'API 키를 코드에 하드코딩'],
      correctIndex: 2,
      explanation: '파라미터화된 쿼리는 SQL Injection을 방지하는 표준적이고 안전한 방법입니다.',
    },
  ]}
/>

<ChapterNav
  prev={{ title: 'Python API', path: '/docs/part-5--실전-예제-python-api' }}
  next={{ title: '팀 협업', path: '/docs/part-6--모범-사례-팀-협업' }}
/>
